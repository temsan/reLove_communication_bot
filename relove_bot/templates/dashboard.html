<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–ê–¥–º–∏–Ω–∫–∞ reLove</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: #f7f8fa;
      color: #1a1a1a;
      margin: 0;
      padding: 0;
    }
    .dashboard-title-bar {
      background: linear-gradient(90deg, #e94e77 0%, #7f53ac 100%);
      border-radius: 2rem;
      box-shadow: 0 2px 16px 0 rgba(127,83,172,0.09);
      padding: 1.1rem 1.6rem 1.1rem 2.1rem;
      margin: 0 0 2rem 0;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      min-height: 68px;
    }
    .dashboard-title {
      color: #fff;
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: 0.01em;
      text-shadow: 0 1px 8px rgba(127,83,172,0.08);
      display: flex;
      align-items: center;
    }
    .dashboard-title .relove-heart {
      margin-left: 0.5rem;
      font-size: 2.1rem;
      vertical-align: middle;
      filter: drop-shadow(0 1px 4px rgba(233,78,119,0.13));
    }
    .relove-tabs .nav-link.relove-tab-btn {
      border: none;
      background: none;
      color: #7f53ac;
      font-weight: 500;
      border-radius: 0;
      padding: 0.7rem 1.2rem;
      transition: color 0.2s;
    }
    .relove-tabs .nav-link.relove-tab-btn.active {
      color: #fff;
      background: #7f53ac;
      border-radius: 1.2rem 1.2rem 0 0;
    }
    .modern-users-grid {
      background: none;
      padding: 0;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 1.2rem;
      max-width: 1200px;
    }
    .modern-user-card {
      background: #fff;
      border-radius: 1.1rem;
      box-shadow: 0 1px 7px 0 rgba(127,83,172,0.06);
      border: 1px solid #f1f1f4;
      transition: box-shadow 0.14s, border-color 0.10s;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 200px;
    }
    .modern-user-card:hover {
      box-shadow: 0 6px 20px 0 rgba(127,83,172,0.09);
      border-color: #7f53ac;
    }
    .modern-user-photo-wrap {
      width: 100%;
      height: 110px;
      background: #f5f5fa;
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 1px solid #f1f1f4;
    }
    .modern-user-photo {
      width: 70%;
      height: 70%;
      object-fit: cover;
      border-radius: 0.6rem;
      background: #f4f4f7;
      border: none;
      box-shadow: 0 1px 4px 0 rgba(127,83,172,0.03);
    }
    .modern-user-photo--empty {
      background: #f4f4f7;
      border: 1px dashed #e0e0e0;
      border-radius: 0.6rem;
      color: #bbb;
      font-size: 1.2rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 70%;
      height: 70%;
    }
    input[type='text'], .form-control {
      border-radius: 0.7rem;
      border: 1px solid #e0e0e0;
      background: #fafbfc;
      padding: 0.5rem 1rem;
      font-size: 1rem;
    }
    input[type='text']:focus, .form-control:focus {
      outline: none;
      border-color: #7f53ac;
      background: #fff;
    }
    button, .btn {
      border-radius: 0.7rem;
      background: #7f53ac;
      color: #fff;
      border: none;
      font-weight: 500;
      padding: 0.5rem 1.4rem;
      transition: background 0.18s;
    }
    button:hover, .btn:hover {
      background: #d72660;
      color: #fff;
    }
    .modern-user-info {
      width: 100%;
      padding: 0.3em 0.4em 0.3em 0.4em;
      background: transparent;
      text-align: left;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: flex-start;
      gap: 0.03em;
    }
    .modern-user-name {
      font-size: 0.93em;
      font-weight: 500;
      color: #181828;
      margin-bottom: 0.03em;
      letter-spacing: 0.01em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    .modern-user-username {
      font-size: 0.78em;
      color: #7f53ac;
      opacity: 1;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    /* Tooltip —Å–∞–º–º–∞—Ä–∏ */
    .modern-user-summary-tooltip {
      display: none;
      position: absolute;
      left: 50%;
      top: -12px;
      transform: translate(-50%, -100%) scale(0.97);
      min-width: 120px;
      max-width: 220px;
      background: #fff;
      color: #222;
      border: 1px solid #ececf5;
      border-radius: 0.6rem;
      box-shadow: 0 2px 10px 0 rgba(127,83,172,0.07);
      padding: 0.3em 0.6em 0.3em 0.6em;
      z-index: 99;
      font-size: 0.90em;
      text-align: left;
      pointer-events: auto;
      opacity: 0;
      transition: opacity 0.13s, transform 0.18s;
      max-height: 180px;
      overflow-y: auto;
      word-break: break-word;
    }
    .modern-user-photo-wrap:hover .modern-user-summary-tooltip {
      display: block;
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -105%) scale(1);
      animation: fadeInSummaryModern 0.14s;
      margin-bottom: 2px;
      max-height: 400px;
    }
    @keyframes fadeInSummaryModern {
      from { opacity: 0; transform: translate(-50%, -100%) scale(0.96); }
      to { opacity: 1; transform: translate(-50%, -128%) scale(1); }
    }
    .modern-user-summary-label {
      color: #7f53ac;
      font-size: 0.85em;
      font-weight: 600;
      margin-bottom: 0.18em;
      letter-spacing: 0.01em;
    }
    .modern-user-summary-text {
      color: #222;
      font-size: 0.85em;
      font-weight: 400;
      white-space: pre-line;
      word-break: break-word;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      max-height: 3.8em;
    }
    .modern-user-summary-tooltip::after {
      content: '';
      position: absolute;
      left: 50%;
      top: 100%;
      transform: translateX(-50%) rotate(45deg);
      width: 10px;
      height: 10px;
      background: #fff;
      border-left: 1px solid #ececf5;
      border-bottom: 1px solid #ececf5;
      box-shadow: 0 1px 3px 0 rgba(127,83,172,0.04);
      border-radius: 0 0 0.3em 0;
      z-index: 100;
      pointer-events: none;
      clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
    }

.modern-user-card {
  background: #222;
  color: #fff;
  aspect-ratio: 1 / 1;
  width: 100%;
  min-width: 0;
  max-width: 210px;
  min-height: 0;
  max-height: 210px;
  margin: 0 auto;
  border-radius: 1.1rem;
  overflow: hidden;
  position: relative;
  box-shadow: none;
  border: none;
  padding: 0;
  display: flex;
  flex-direction: column;
  justify-content: stretch;
  align-items: stretch;
}
    .user-photo-bg {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      filter: brightness(0.55);
      z-index: 0;
      transition: filter .2s;
      border-radius: 1.5rem;
      box-shadow: none;
      border: none;
    }
    .user-photo-bg--empty {
      background: linear-gradient(135deg, #e0e6fa 70%, #f8e1f6 100%);
    }
    .user-photo-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.48) 60%, rgba(127,83,172,0.25) 100%);
      z-index: 1;
    }
    .user-photo-content {
      color: #fff !important;
      text-shadow: 0 2px 12px #000a;
      padding: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .user-photo-name, .user-photo-username, .user-photo-badge, .user-photo-summary-label, .user-photo-summary-text {
      color: #fff !important;
    }
    .user-photo-username {
      opacity: 0.92;
    }
    .user-photo-badge {
      background: rgba(127,83,172,0.55);
      color: #fff;
      border: none;
      font-weight: 500;
      font-size: 1.01rem;
      margin-bottom: 0.2rem;
    }
    .user-photo-summary-bubble {
      display: none;
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%) scale(0.85);
      min-width: 270px;
      max-width: 400px;
      background: #fff;
      color: #222;
      border-radius: 1.2rem;
      box-shadow: 0 8px 32px 0 rgba(60,40,120,0.20);
      z-index: 20;
      padding: 1.4rem 1.4rem 1.2rem 1.4rem;
      text-align: left;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.16s, transform 0.18s;
      margin-left: 22px;
      font-size: 1.18rem;
    }
    .user-photo-card:hover .user-photo-summary-bubble {
      display: block;
      opacity: 1;
      pointer-events: auto;
      transform: translateY(-50%) scale(1);
      animation: bubbleGrow 0.18s;
    }
    @keyframes bubbleGrow {
      from { opacity: 0; transform: translateY(-50%) scale(0.85); }
      to   { opacity: 1; transform: translateY(-50%) scale(1); }
    }
    .user-photo-summary-bubble-arrow {
      position: absolute;
      left: -18px;
      top: 50%;
      transform: translateY(-50%);
      width: 28px;
      height: 28px;
      pointer-events: none;
      z-index: 21;
      overflow: visible;
    }
    .user-photo-summary-bubble-arrow::before {
      content: '';
      position: absolute;
      left: 6px;
      top: 50%;
      transform: translateY(-50%) rotate(-45deg);
      width: 20px;
      height: 20px;
      background: #fff;
      border-radius: 0 0 0 1rem;
      box-shadow: -2px 2px 10px 0 rgba(60,40,120,0.10);
      z-index: 22;
      border: 1.5px solid #e0e6fa;
    }
    .user-photo-summary-bubble-inner {
      width: 100%;
      max-height: 240px;
      overflow-y: auto;
    }
    .user-photo-summary-label {
      color: #7f53ac;
      font-size: 1.1rem;
      font-weight: 700;
      opacity: 1;
      margin-bottom: 0.7em;
      letter-spacing: 0.02em;
    }
    .user-photo-summary-text {
      color: #222;
      font-size: 1.13rem;
      opacity: 0.98;
      white-space: pre-line;
      word-break: break-word;
      font-weight: 400;
    }

    .dashboard-header {
        background: linear-gradient(90deg, #d72660 0%, #7f53ac 100%);
        color: #fff;
        border-radius: 1.5rem;
        box-shadow: 0 4px 24px 0 rgba(215,38,96,0.10);
        padding: 2.2rem 1.5rem 1.2rem 1.5rem;
        margin-bottom: 2rem;
        letter-spacing: 1px;
        position: relative;
    }
    .dashboard-header h1 {
        font-weight: 800;
        font-size: 2.5rem;
        letter-spacing: 2px;
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }
    .dashboard-header .relove-heart {
        font-size: 2.7rem;
        color: #fff;
        text-shadow: 0 2px 12px #d72660cc;
        margin-left: 0.2em;
        vertical-align: middle;
        animation: relove-heartbeat 1.2s infinite;
    }
    @keyframes relove-heartbeat {
        0%, 100% { transform: scale(1); }
        10% { transform: scale(1.15); }
        20% { transform: scale(0.92); }
        30% { transform: scale(1.12); }
        40% { transform: scale(0.98); }
        50% { transform: scale(1.1); }
        60% { transform: scale(0.96); }
        70% { transform: scale(1.04); }
        80% { transform: scale(0.98); }
        90% { transform: scale(1.02); }
    }
    .relove-card {
  background: linear-gradient(90deg, #e94e77 0%, #7f53ac 100%);
  border-radius: 1.6rem;
  box-shadow: 0 2px 16px 0 rgba(127,83,172,0.09);
  padding: 1.4rem 1.8rem 1.3rem 1.8rem;
  margin-bottom: 2rem;
  color: #fff;
  border: none;
  display: flex;
  flex-direction: column;
  min-height: 210px;
}
.relove-card-title {
  font-size: 1.35rem;
  font-weight: 700;
  margin-bottom: 1rem;
  color: #fff;
  letter-spacing: 0.01em;
  text-shadow: 0 1px 8px rgba(127,83,172,0.09);
}
.relove-card .btn,
.relove-btn, .btn.btn-danger, .btn.btn-success, .btn.btn-warning, .btn.btn-info, .btn.btn-primary, .btn.btn-secondary, .btn.btn-dark {
  background: #7f53ac;
  color: #fff;
  border-radius: 1.2rem;
  border: none;
  font-weight: 600;
  padding: 0.65rem 1.5rem;
  box-shadow: 0 1px 6px 0 rgba(127,83,172,0.08);
  transition: background 0.18s, box-shadow 0.18s;
}
.relove-card .btn:hover,
.relove-btn:hover, .btn.btn-danger:hover, .btn.btn-success:hover, .btn.btn-warning:hover, .btn.btn-info:hover, .btn.btn-primary:hover, .btn.btn-secondary:hover, .btn.btn-dark:hover {
  background: #e94e77;
  color: #fff;
  box-shadow: 0 3px 16px 0 rgba(127,83,172,0.13);
}
.relove-card .badge {
  background: rgba(255,255,255,0.14);
  color: #fff;
}
.relove-card {
  transition: transform .18s, box-shadow .18s;
  position: relative;
  overflow: visible;
  min-height: 120px;
  padding: 1.2rem 1rem 1.1rem 1rem;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
    .relove-card:hover {
        transform: translateY(-6px) scale(1.03);
        box-shadow: 0 16px 48px 0 rgba(215,38,96,0.18);
    }
    .relove-heart-frame {
        width: 82px; height: 74px;
        background: linear-gradient(135deg, #d72660 0%, #7f53ac 100%);
        clip-path: path('M41,74 C-10,44 0,10 41,29 C82,10 92,44 41,74 Z');
        display: flex; align-items: center; justify-content: center;
        margin-bottom: 1.2rem;
        box-shadow: 0 4px 16px 0 rgba(215,38,96,0.13);
        position: relative;
        z-index: 2;
        border: 3px solid #fff;
    }
    .relove-heart-frame img {
        width: 62px; height: 62px; object-fit: cover;
        border-radius: 50%;
        border: 3px solid #fff;
        box-shadow: 0 2px 8px 0 rgba(127,83,172,0.12);
    }
    .relove-username {
        font-family: 'Pacifico', cursive, sans-serif;
        color: #d72660;
        font-size: 1.1rem;
        margin-bottom: 0.4rem;
    }
    .relove-name {
        font-weight: 700;
        font-size: 1.3rem;
        color: #7f53ac;
        margin-bottom: 0.3rem;
    }
    .relove-badges .badge {
        margin: 0 0.15rem 0.3rem 0.15rem;
        font-size: 0.93rem;
        border-radius: 1rem;
        padding: 0.45em 1.1em;
    }
    .relove-badges .badge-gender {
        background: linear-gradient(90deg, #d72660 0%, #7f53ac 100%);
        color: #fff;
    }
    .relove-badges .badge-streams {
        background: linear-gradient(90deg, #fbb1b1 0%, #f8e1f6 100%);
        color: #d72660;
        border: 1px solid #fbb1b1;
    }
    .relove-badges .badge-posts {
        background: #e0e6fa;
        color: #7f53ac;
        border: 1px solid #e0e6fa;
    }
    .relove-summary-card {
        background: linear-gradient(120deg, #fff 60%, #f8e1f6 100%);
        border-radius: 1.2rem;
        box-shadow: 0 1px 8px 0 rgba(127,83,172,0.07);
        margin-top: 1.2rem;
        padding: 1rem 1.2rem 0.7rem 1.2rem;
        min-height: 85px;
        position: relative;
    }
    .relove-summary-card:before {
        content: '\2665';
        position: absolute;
        top: -18px; left: 14px;
        color: #d72660;
        font-size: 1.3rem;
        opacity: 0.18;
        z-index: 0;
    }
    .relove-summary-title {
        font-size: 0.97rem;
        color: #d72660;
        font-weight: 600;
        margin-bottom: 0.3rem;
        letter-spacing: 0.5px;
    }
    .relove-summary-text {
        color: #7f53ac;
        font-size: 1.05rem;
        white-space: pre-line;
        z-index: 2;
        position: relative;
    }
    .relove-heart-emoji {
        position: absolute;
        top: 8px; right: 18px;
        font-size: 1.6rem;
        opacity: 0.25;
        pointer-events: none;
    }
</style>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

<body>
<!-- –í–µ—Ä—Ö–Ω–µ–µ –º–µ–Ω—é —É–±—Ä–∞–Ω–æ –ø–æ –ø—Ä–æ—Å—å–±–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
<div style="height:58px;"></div>
<div class="container py-3">
    <div class="dashboard-title-bar mb-4">
        <span class="dashboard-title">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π <span class="relove-heart">‚ù§</span></span>
    </div>
    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <ul class="nav nav-tabs mb-3 relove-tabs" id="dashboardTabs" role="tablist" style="border-radius: 1.2rem; overflow: hidden; background: linear-gradient(90deg, #f8e1f6 0%, #e0e6fa 100%);">
      <li class="nav-item" role="presentation">
        <button class="nav-link relove-tab-btn {% if active_tab == 'analytics' or not active_tab %}active{% endif %}" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab" aria-controls="analytics" aria-selected="true">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link relove-tab-btn {% if active_tab == 'users' %}active{% endif %}" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab" aria-controls="users" aria-selected="false">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link relove-tab-btn {% if active_tab == 'mailing' %}active{% endif %}" id="mailing-tab" data-bs-toggle="tab" data-bs-target="#mailing" type="button" role="tab" aria-controls="mailing" aria-selected="false">–†–∞—Å—Å—ã–ª–∫–∞</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link relove-tab-btn {% if active_tab == 'automation' %}active{% endif %}" id="automation-tab" data-bs-toggle="tab" data-bs-target="#automation" type="button" role="tab" aria-controls="automation" aria-selected="false">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</button>
      </li>
    </ul>
    <div class="tab-content" id="dashboardTabsContent">
  <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
  <div class="tab-pane fade show active" id="analytics" role="tabpanel" aria-labelledby="analytics-tab">
    <div class="row mb-4 justify-content-center g-3 flex-nowrap overflow-auto" style="gap: 1.5rem;">
      <div class="col-auto" style="min-width:200px;">
        <div class="card relove-card relove-metric text-center">
          <div class="card-body">
            <div class="relove-metric-icon">‚ù§Ô∏è</div>
            <div class="relove-metric-value">{{ total_users }}</div>
            <div class="relove-metric-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
          </div>
        </div>
      </div>
      <div class="col-auto" style="min-width:200px;">
        <div class="card relove-card relove-metric text-center">
          <div class="card-body">
            <div class="relove-metric-icon">‚ôÇÔ∏è</div>
            <div class="relove-metric-value">{{ male_count }}</div>
            <div class="relove-metric-label">–ú—É–∂—á–∏–Ω</div>
          </div>
        </div>
      </div>
      <div class="col-auto" style="min-width:200px;">
        <div class="card relove-card relove-metric text-center">
          <div class="card-body">
            <div class="relove-metric-icon">‚ôÄÔ∏è</div>
            <div class="relove-metric-value">{{ female_count }}</div>
            <div class="relove-metric-label">–ñ–µ–Ω—â–∏–Ω</div>
          </div>
        </div>
      </div>
      <div class="col-auto" style="min-width:200px;">
        <div class="card relove-card relove-metric text-center">
          <div class="card-body">
            <div class="relove-metric-icon">‚ùì</div>
            <div class="relove-metric-value">{{ unknown_count }}</div>
            <div class="relove-metric-label">–ù–µ —É–∫–∞–∑–∞–Ω–æ</div>
          </div>
        </div>
      </div>
    </div>
    <div class="row g-4">
      <div class="col-12 col-lg-6">
        <div class="card chart-card">
          <div class="card-body">
            <h5 class="card-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É</h5>
            <canvas id="gender-chart" style="max-height:340px;"></canvas>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="card chart-card">
          <div class="card-body">
            <h5 class="card-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ—Ç–æ–∫–∞–º</h5>
            <canvas id="streams-chart" style="max-height:340px;"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
  <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="users-tab">
    <form class="relove-form search-form mb-4" method="get" action="/admin/search">
      <div class="input-group">
        <input type="text" class="form-control" name="query" placeholder="ID, –∏–º—è, username, –ø–æ—Ç–æ–∫..." style="border-radius: 1rem 0 0 1rem;">
        <button class="relove-btn" type="submit">–ò—Å–∫–∞—Ç—å</button>
      </div>
    </form>
    <div class="modern-users-grid"></div>
    <style>
.user-list-grid-modern {
  width: 100%; margin:0 auto;
  display:grid; grid-template-columns:repeat(6,1fr);
  gap:8px; padding:0 0 12px 0; max-width:1200px;
}
@media (max-width:1200px) {
  .user-list-grid-modern { grid-template-columns:repeat(4,1fr); }
}
@media (max-width:900px) {
  .user-list-grid-modern { grid-template-columns:repeat(3,1fr); }
}
@media (max-width:600px) {
  .user-list-grid-modern { grid-template-columns:repeat(2,1fr); }
}
@media (max-width:400px) {
  .user-list-grid-modern { grid-template-columns:1fr; }
}
@media (min-width:700px) {
  .user-list-grid-modern { grid-template-columns:1fr 1fr; gap:28px; }
}
@media (min-width:1100px) {
  .user-list-grid-modern { grid-template-columns:repeat(3,1fr); }
}
</style>
  </div>
  <!-- –†–∞—Å—Å—ã–ª–∫–∞ -->
  <div class="tab-pane fade" id="mailing" role="tabpanel" aria-labelledby="mailing-tab">
    <div class="row justify-content-center">
      <div class="col-md-7 col-lg-6">
        <form method="post" action="/admin/mailing" class="relove-form">
          <h5 class="mb-3">–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</h5>
          <div class="mb-3">
            <label for="genderSelect" class="form-label">–ü–æ–ª</label>
            <select class="form-select" id="genderSelect" name="gender">
              <option value="">–õ—é–±–æ–π</option>
              <option value="male">–ú—É–∂—Å–∫–æ–π</option>
              <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
              <option value="unknown">–ù–µ —É–∫–∞–∑–∞–Ω</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="streamsSelect" class="form-label">–ü–æ—Ç–æ–∫–∏</label>
            <select multiple class="form-select" id="streamsSelect" name="streams">
              {% for stream in stream_labels %}
              <option value="{{ stream }}">{{ stream }}</option>
              {% endfor %}
            </select>
            <div class="form-text">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ (Ctrl/Command + –∫–ª–∏–∫)</div>
          </div>
          <div class="mb-3">
            <label for="mailingText" class="form-label">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</label>
            <textarea class="form-control" id="mailingText" name="message" rows="4" required></textarea>
          </div>
          <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-danger">–†–∞–∑–æ—Å–ª–∞—Ç—å</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <!-- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è -->
  <div class="tab-pane fade" id="automation" role="tabpanel" aria-labelledby="automation-tab">
    <div class="row g-4">
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3">
          <div class="relove-card-title">–ú–∞—Å—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª–µ–π</div>
          <div class="card-body">
            <p class="card-text">–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∞—Å—Å–æ–≤—ã–π —Å–±–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∫–∞–Ω–∞–ª–∞.</p>
            <form method="post" action="/dashboard/auto_analyze">
              <button type="submit" class="btn btn-primary">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª–µ–π</button>
            </form>
            <div class="mt-2">
              <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ auto_analyze_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3">
          <div class="relove-card-title">–ú–∞—Å—Å–æ–≤–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–∞</div>
          <div class="card-body">
            <p class="card-text">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –ø—Ä–æ—Ñ–∏–ª—é.</p>
            <form method="post" action="/dashboard/auto_gender">
              <button type="submit" class="btn btn-info">–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–∞</button>
            </form>
            <div class="mt-2">
              <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ auto_gender_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3">
          <div class="relove-card-title">–ú–∞—Å—Å–æ–≤–æ–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
          <div class="card-body">
            <p class="card-text">–°–æ–±—Ä–∞—Ç—å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ—Ä—Ç—Ä–µ—Ç—ã –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
            <form method="post" action="/dashboard/auto_psych">
              <button type="submit" class="btn btn-warning">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
            </form>
            <div class="mt-2">
              <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ auto_psych_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3">
          <div class="relove-card-title">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π</div>
          <div class="card-body">
            <p class="card-text">–í–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–∞—Å—Å—ã–ª–∫—É –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–æ–≤—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º.</p>
            <form method="post" action="/dashboard/auto_welcome">
              <button type="submit" class="btn btn-success">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π</button>
            </form>
            <div class="mt-2">
              <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ auto_welcome_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3">
          <div class="relove-card-title">–®–∞–±–ª–æ–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</div>
          <div class="card-body">
            <form method="post" action="/dashboard/welcome_template">
              <div class="mb-3">
                <label for="welcomeTemplate" class="form-label">–¢–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è</label>
                <textarea class="form-control" id="welcomeTemplate" name="welcome_template" rows="3">{{ welcome_template }}</textarea>
              </div>
              <button type="submit" class="btn btn-secondary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
            </form>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3">
          <div class="relove-card-title">–ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –æ —Å–æ–±—ã—Ç–∏—è—Ö</div>
          <div class="card-body">
            <form method="post" action="/dashboard/broadcast_events">
              <div class="mb-3">
                <label for="eventText" class="form-label">–¢–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è</label>
                <textarea class="form-control" id="eventText" name="event_text" rows="2" required></textarea>
              </div>
              <button type="submit" class="btn btn-danger">–†–∞–∑–æ—Å–ª–∞—Ç—å –≤—Å–µ–º</button>
            </form>
            <div class="mt-2">
              <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ broadcast_events_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3">
          <div class="relove-card-title">–ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</div>
          <div class="card-body">
            <form method="post" action="/dashboard/auto_reminders">
              <div class="mb-3">
                <label for="reminderText" class="form-label">–¢–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</label>
                <textarea class="form-control" id="reminderText" name="reminder_text" rows="2" required></textarea>
              </div>
              <div class="mb-3">
                <label for="reminderTimestamp" class="form-label">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (UNIX timestamp)</label>
                <input type="number" class="form-control" id="reminderTimestamp" name="reminder_time" required>
              </div>
              <button type="submit" class="btn btn-dark">–°–æ–∑–¥–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</button>
            </form>
            <div class="mt-2">
              <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ auto_reminders_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="card border-info mb-3">
          <div class="card-header bg-info text-dark">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–Ω–∞–ª–∞–º–∏</div>
          <div class="card-body">
            <p>–¢–µ–∫—É—â–∏–µ –∫–∞–Ω–∞–ª—ã –∏ —á–∞—Ç—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:</p>
            <ul class="list-group mb-2">
              {% for channel in channels %}
              <li class="list-group-item">ID: <b>{{ channel.id }}</b> ‚Äî {{ channel.title }}</li>
              {% endfor %}
            </ul>
            <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ channels_status|default('OK') }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

      <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
      <!-- ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏) ... -->
      <!-- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è -->
      <div class="tab-pane fade" id="automation" role="tabpanel" aria-labelledby="automation-tab">
        <div class="row g-4">
          <div class="col-12 col-lg-6">
            <div class="card border-primary mb-3">
              <div class="card-header bg-primary text-white">–ú–∞—Å—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª–µ–π</div>
              <div class="card-body">
                <p class="card-text">–ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∞—Å—Å–æ–≤—ã–π —Å–±–æ—Ä –∏ –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∫–∞–Ω–∞–ª–∞.</p>
                <form method="post" action="/dashboard/auto_analyze">
                  <button type="submit" class="btn btn-primary">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ñ–∏–ª–µ–π</button>
                </form>
                <div class="mt-2">
                  <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ auto_analyze_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-info mb-3">
              <div class="card-header bg-info text-dark">–ú–∞—Å—Å–æ–≤–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–∞</div>
              <div class="card-body">
                <p class="card-text">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –ø—Ä–æ—Ñ–∏–ª—é.</p>
                <form method="post" action="/dashboard/auto_gender">
                  <button type="submit" class="btn btn-info">–ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–∞</button>
                </form>
                <div class="mt-2">
                  <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ auto_gender_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-warning mb-3">
              <div class="card-header bg-warning text-dark">–ú–∞—Å—Å–æ–≤–æ–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
              <div class="card-body">
                <p class="card-text">–°–æ–±—Ä–∞—Ç—å –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –ø–æ—Ä—Ç—Ä–µ—Ç—ã –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.</p>
                <form method="post" action="/dashboard/auto_psych">
                  <button type="submit" class="btn btn-warning">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
                </form>
                <div class="mt-2">
                  <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ auto_psych_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-success mb-3">
              <div class="card-header bg-success text-white">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π</div>
              <div class="card-body">
                <p class="card-text">–í–∫–ª—é—á–∏—Ç—å/–æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–∞—Å—Å—ã–ª–∫—É –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–æ–≤—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º.</p>
                <form method="post" action="/dashboard/auto_welcome">
                  <button type="submit" class="btn btn-success">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π</button>
                </form>
                <div class="mt-2">
                  <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ auto_welcome_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-secondary mb-3">
              <div class="card-header bg-secondary text-white">–®–∞–±–ª–æ–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</div>
              <div class="card-body">
                <form method="post" action="/dashboard/welcome_template">
                  <div class="mb-3">
                    <label for="welcomeTemplate" class="form-label">–¢–µ–∫—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è</label>
                    <textarea class="form-control" id="welcomeTemplate" name="welcome_template" rows="3">{{ welcome_template }}</textarea>
                  </div>
                  <button type="submit" class="btn btn-secondary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
                </form>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-danger mb-3">
              <div class="card-header bg-danger text-white">–ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –æ —Å–æ–±—ã—Ç–∏—è—Ö</div>
              <div class="card-body">
                <form method="post" action="/dashboard/broadcast_events">
                  <div class="mb-3">
                    <label for="eventText" class="form-label">–¢–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è</label>
                    <textarea class="form-control" id="eventText" name="event_text" rows="2" required></textarea>
                  </div>
                  <button type="submit" class="btn btn-danger">–†–∞–∑–æ—Å–ª–∞—Ç—å –≤—Å–µ–º</button>
                </form>
                <div class="mt-2">
                  <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ broadcast_events_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-dark mb-3">
              <div class="card-header bg-dark text-white">–ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</div>
              <div class="card-body">
                <form method="post" action="/dashboard/auto_reminders">
                  <div class="mb-3">
                    <label for="reminderText" class="form-label">–¢–µ–∫—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</label>
                    <textarea class="form-control" id="reminderText" name="reminder_text" rows="2" required></textarea>
                  </div>
                  <div class="mb-3">
                    <label for="reminderTimestamp" class="form-label">–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (UNIX timestamp)</label>
                    <input type="number" class="form-control" id="reminderTimestamp" name="reminder_time" required>
                  </div>
                  <button type="submit" class="btn btn-dark">–°–æ–∑–¥–∞—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è</button>
                </form>
                <div class="mt-2">
                  <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ auto_reminders_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-info mb-3">
              <div class="card-header bg-info text-dark">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞–Ω–∞–ª–∞–º–∏</div>
              <div class="card-body">
                <p>–¢–µ–∫—É—â–∏–µ –∫–∞–Ω–∞–ª—ã –∏ —á–∞—Ç—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:</p>
                <ul class="list-group mb-2">
                  {% for channel in channels %}
                  <li class="list-group-item">ID: <b>{{ channel.id }}</b> ‚Äî {{ channel.title }}</li>
                  {% endfor %}
                </ul>
                <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ channels_status|default('OK') }}</span>
              </div>
        </div>
      </div>

    

      <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
      <div class="tab-pane fade show active" id="analytics" role="tabpanel" aria-labelledby="analytics-tab">
        <div class="row mb-4 justify-content-center g-3 flex-nowrap overflow-auto" style="gap: 1.5rem;">
            <div class="col-auto" style="min-width:200px;">
                <div class="card relove-card relove-metric text-center">
                    <div class="card-body">
                        <div class="relove-metric-icon">‚ù§Ô∏è</div>
                        <div class="relove-metric-value">{{ total_users }}</div>
                        <div class="relove-metric-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                </div>
            </div>
            <div class="col-auto" style="min-width:200px;">
                <div class="card relove-card relove-metric text-center">
                    <div class="card-body">
                        <div class="relove-metric-icon">‚ôÇÔ∏è</div>
                        <div class="relove-metric-value">{{ male_count }}</div>
                        <div class="relove-metric-label">–ú—É–∂—á–∏–Ω</div>
                    </div>
                </div>
            </div>
            <div class="col-auto" style="min-width:200px;">
                <div class="card relove-card relove-metric text-center">
                    <div class="card-body">
                        <div class="relove-metric-icon">‚ôÄÔ∏è</div>
                        <div class="relove-metric-value">{{ female_count }}</div>
                        <div class="relove-metric-label">–ñ–µ–Ω—â–∏–Ω</div>
                    </div>
                </div>
            </div>
            <div class="col-auto" style="min-width:200px;">
                <div class="card relove-card relove-metric text-center">
                    <div class="card-body">
                        <div class="relove-metric-icon">‚ùì</div>
                        <div class="relove-metric-value">{{ unknown_count }}</div>
                        <div class="relove-metric-label">–ù–µ —É–∫–∞–∑–∞–Ω–æ</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row g-4">
            <div class="col-12 col-lg-6">
                <div class="card chart-card">
                    <div class="card-body">
                        <h5 class="card-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É</h5>
                        <canvas id="gender-chart" style="max-height:340px;"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="card chart-card">
                    <div class="card-body">
                        <h5 class="card-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ—Ç–æ–∫–∞–º</h5>
                        <canvas id="streams-chart" style="max-height:340px;"></canvas>
                    </div>
                </div>
            </div>
        </div>
      </div>
      <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
      <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="users-tab">
        <form class="relove-form search-form mb-4" method="get" action="/admin/search">
          <div class="input-group">
            <input type="text" class="form-control" name="query" placeholder="ID, –∏–º—è, username, –ø–æ—Ç–æ–∫..." style="border-radius: 1rem 0 0 1rem;">
            <button class="relove-btn" type="submit">–ò—Å–∫–∞—Ç—å</button>
          </div>
        </form>
        <div class="modern-users-grid"></div>
<style>
.user-list-grid-modern {
  width: 100%;
  margin: 0 auto;
  display: grid;
  grid-template-columns: 1fr;
  gap: 22px;
  padding: 0 0 24px 0;
  max-width: 1200px;
}
@media (min-width: 700px) {
  .user-list-grid-modern {
    grid-template-columns: 1fr 1fr;
    gap: 28px;
  }
}
@media (min-width: 1100px) {
  .user-list-grid-modern {
    grid-template-columns: 1fr 1fr 1fr;
    gap: 32px;
  }
}

@media (min-width: 600px) {
  .user-list-grid {
    grid-template-columns: 1fr 1fr;
    gap: 18px;
  }
}
@media (min-width: 1000px) {
  .user-list-grid {
    grid-template-columns: 1fr 1fr 1fr;
    gap: 18px;
  }
}
.user-card-bg-modern {
  position: relative;
  min-height: 180px;
  min-width: 0;
  border-radius: 1.2em;
  box-shadow: 0 2px 18px 0 rgba(127,83,172,0.11);
  display: flex;
  align-items: flex-end;
  justify-content: center;
  overflow: hidden;
  background-size: cover;
  background-position: center;
  transition: box-shadow .13s;
}
.user-card-bg-modern:hover {
  box-shadow: 0 8px 28px 0 rgba(127,83,172,0.18);
}
.user-card-bg-overlay-modern {
  position: absolute;
  inset: 0;
  background: linear-gradient(0deg, rgba(40,18,60,0.32) 70%, rgba(40,18,60,0.07) 100%);
  z-index: 1;
}
.user-summary-bg-modern {
  position: relative;
  z-index: 2;
  color: #fff;
  background: rgba(127,83,172,0.82);
  border-radius: 0.9em 0.9em 0 0;
  padding: 0.9em 1.2em 0.9em 1.2em;
  font-size: 1.08em;
  font-weight: 500;
  text-align: center;
  max-width: 95%;
  min-width: 0;
  word-break: break-word;
  box-shadow: 0 2px 12px 0 rgba(127,83,172,0.10);
  display: -webkit-box;
  -webkit-line-clamp: 4;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  line-clamp: 4;
  min-height: 2.8em;
  margin: 0.7em 0.6em 1.1em 0.6em;
  opacity: 0.98;
}
@media (max-width: 900px) {
  .user-summary-bg-modern {
    font-size: 0.98em;
    padding: 0.7em 0.6em 0.7em 0.6em;
  }
  .user-card-bg-modern {
    min-height: 120px;
  }
}
@media (max-width: 600px) {
  .user-card-bg-modern {
    min-height: 90px;
  }
  .user-summary-bg-modern {
    font-size: 0.93em;
    padding: 0.5em 0.3em 0.5em 0.3em;
    border-radius: 0.7em;
  }
}

.user-card-vertical:hover {
  box-shadow: 0 4px 24px 0 rgba(127,83,172,0.17);
}
.user-photo-vertical {
  width: 58px;
  height: 58px;
  border-radius: 50%;
  overflow: hidden;
  background: linear-gradient(135deg, #e0e6fa 70%, #f8e1f6 100%);
  margin-bottom: 7px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.user-photo-vertical img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
.user-photo-empty-vertical {
  width: 100%;
  height: 100%;
  background: repeating-linear-gradient(135deg, #e0e6fa 0 10px, #f8e1f6 10px 20px);
  border-radius: 50%;
}
.user-summary-vertical {
  margin-top: 0;
  color: #7f53ac;
  background: #f5f2fa;
  border-radius: 0.6em;
  padding: 0.45em 0.7em 0.45em 0.7em;
  font-size: 0.93em;
  font-weight: 400;
  text-align: center;
  max-width: 96%;
  min-width: 0;
  word-break: break-word;
  box-shadow: 0 1px 4px 0 rgba(127,83,172,0.05);
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  line-clamp: 3;
  height: auto;
  min-height: 2.7em;
}
@media (max-width: 600px) {
  .user-list-grid {
    max-width: 100%;
    padding: 0 2vw 18px 2vw;
  }
  .user-card-vertical {
    padding: 8px 2vw 8px 2vw;
  }
  .user-photo-vertical {
    width: 44px;
    height: 44px;
  }
  .user-summary-vertical {
    font-size: 0.87em;
    padding: 0.33em 0.5em 0.33em 0.5em;
  }
}
</style>
      </div>
      <!-- –†–∞—Å—Å—ã–ª–∫–∞ -->
      <div class="tab-pane fade" id="mailing" role="tabpanel" aria-labelledby="mailing-tab">
        <div class="row justify-content-center">
          <div class="col-md-7 col-lg-6">
            <form method="post" action="/admin/mailing" class="relove-form">
              <h5 class="mb-3">–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</h5>
              <div class="mb-3">
                <label for="genderSelect" class="form-label">–ü–æ–ª</label>
                <select class="form-select" id="genderSelect" name="gender">
                  <option value="">–õ—é–±–æ–π</option>
                  <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                  <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
                  <option value="unknown">–ù–µ —É–∫–∞–∑–∞–Ω</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="streamsSelect" class="form-label">–ü–æ—Ç–æ–∫–∏</label>
                <select multiple class="form-select" id="streamsSelect" name="streams">
                  {% for stream in stream_labels %}
                  <option value="{{ stream }}">{{ stream }}</option>
                  {% endfor %}
                </select>
                <div class="form-text">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ (Ctrl/Command + –∫–ª–∏–∫)</div>
              </div>
              <div class="mb-3">
                <label for="mailingText" class="form-label">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</label>
                <textarea class="form-control" id="mailingText" name="message" rows="4" required></textarea>
              </div>
              <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-danger">–†–∞–∑–æ—Å–ª–∞—Ç—å</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
</div>
<script>
let genderChart, streamsChart;

function renderGenderChart(male, female, unknown) {
    const ctx = document.getElementById('gender-chart').getContext('2d');
    if (genderChart) genderChart.destroy();
    genderChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['–ú—É–∂—á–∏–Ω—ã', '–ñ–µ–Ω—â–∏–Ω—ã', '–ù–µ —É–∫–∞–∑–∞–Ω–æ'],
            datasets: [{
                data: [male, female, unknown],
                backgroundColor: ['#0d6efd', '#ffc107', '#adb5bd']
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { position: 'bottom' } }
        }
    });
}
function renderStreamsChart(labels, counts) {
    const ctx = document.getElementById('streams-chart').getContext('2d');
    if (streamsChart) streamsChart.destroy();
    streamsChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',
                data: counts,
                backgroundColor: '#198754'
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true } }
        }
    });
}

async function fetchDashboardData() {
    console.log('fetchDashboardData: –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ /api/dashboard_data');
    try {
        const resp = await fetch('/api/dashboard_data?_=' + Date.now());
        if (!resp.ok) return;
        const data = await resp.json();
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
        renderGenderChart(data.male_count, data.female_count, data.unknown_count);
        renderStreamsChart(data.stream_labels, data.stream_counts);
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        const usersGrid = document.querySelector('.modern-users-grid');
        if (usersGrid && Array.isArray(data.users)) {
            usersGrid.innerHTML = data.users.map(user => `
  <div class="modern-user-card">
    <div class="modern-user-photo-wrap">
      ${user.photo_jpeg ? `<img class='modern-user-photo' src="data:image/jpeg;base64,${user.photo_jpeg}" alt="–§–æ—Ç–æ">` : `<span class='modern-user-photo--empty'>üë§</span>`}
      <div class="modern-user-summary">${user.profile_summary ? user.profile_summary : '‚Äî'}</div>
    </div>
  </div>
`).join('');
        }
    } catch (e) { /* ignore */ }
}
document.addEventListener('DOMContentLoaded', function() {
    // –ü–µ—Ä–≤–∏—á–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ (–¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞)
    renderGenderChart({{ male_count }}, {{ female_count }}, {{ unknown_count }});
    renderStreamsChart({{ stream_labels|tojson }}, {{ stream_counts|tojson }});
    // –ü–µ—Ä–≤–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤
    fetchDashboardData();
    // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    setInterval(fetchDashboardData, 15000);
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
