<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>reLove –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
    
    :root {
        --glass-bg: rgba(255, 255, 255, 0.15);
        --glass-bg-hover: rgba(255, 255, 255, 0.25);
        --glass-border: rgba(255, 255, 255, 0.3);
        --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        --glass-blur: blur(16px);
        --primary-gradient: linear-gradient(135deg, #e94e77 0%, #b721ff 100%);
        --secondary-gradient: linear-gradient(135deg, #36d1c4 0%, #7f53ac 100%);
        --accent-glow: 0 0 20px rgba(233, 78, 119, 0.4);
    }

    body {
        font-family: 'Inter', Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
        background-size: 400% 400%;
        animation: gradientBG 20s ease infinite;
        color: #ffffff;
        margin: 0;
        padding: 0;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
    }

    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 50%, rgba(233, 78, 119, 0.2) 0%, transparent 50%),
            radial-gradient(circle at 80% 80%, rgba(54, 209, 196, 0.2) 0%, transparent 50%),
            radial-gradient(circle at 40% 20%, rgba(183, 33, 255, 0.2) 0%, transparent 50%);
        z-index: 0;
        pointer-events: none;
    }

    body::after {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.1);
        z-index: 0;
        pointer-events: none;
    }

    @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    /* –ü–ª–∞–≤–∞—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ–Ω–∞ */
    .floating-shapes {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
    }

    .shape {
        position: absolute;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        animation: float 25s infinite ease-in-out;
        opacity: 0.6;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    }

    .shape:nth-child(1) {
        width: 400px;
        height: 400px;
        top: -200px;
        left: -200px;
        animation-delay: 0s;
        background: linear-gradient(135deg, rgba(233, 78, 119, 0.3), rgba(183, 33, 255, 0.1));
    }

    .shape:nth-child(2) {
        width: 300px;
        height: 300px;
        top: 40%;
        right: -150px;
        animation-delay: -8s;
        background: linear-gradient(135deg, rgba(54, 209, 196, 0.3), rgba(127, 83, 172, 0.1));
    }

    .shape:nth-child(3) {
        width: 250px;
        height: 250px;
        bottom: -125px;
        left: 40%;
        animation-delay: -15s;
        background: linear-gradient(135deg, rgba(183, 33, 255, 0.3), rgba(233, 78, 119, 0.1));
    }

    @keyframes float {
        0%, 100% { 
            transform: translate(0, 0) rotate(0deg) scale(1); 
        }
        25% { 
            transform: translate(50px, -50px) rotate(90deg) scale(1.1); 
        }
        50% { 
            transform: translate(100px, 50px) rotate(180deg) scale(0.9); 
        }
        75% { 
            transform: translate(-50px, 100px) rotate(270deg) scale(1.05); 
        }
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∂–∏–¥–∫–∏–º —Å—Ç–µ–∫–ª–æ–º */
    .relove-card {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: 1px solid var(--glass-border);
        border-radius: 2rem;
        box-shadow: var(--glass-shadow);
        padding: 2rem;
        margin-bottom: 2rem;
        color: #ffffff;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        z-index: 1;
    }

    .relove-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--primary-gradient);
        opacity: 0;
        transition: opacity 0.4s ease;
        box-shadow: var(--accent-glow);
    }

    .relove-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%, rgba(255, 255, 255, 0.1) 100%);
        transform: translateX(-100%) skewX(-15deg);
        transition: transform 0.8s ease;
        pointer-events: none;
    }

    .relove-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 60px 0 rgba(31, 38, 135, 0.5), var(--accent-glow);
        background: var(--glass-bg-hover);
        border-color: rgba(255, 255, 255, 0.5);
    }

    .relove-card:hover::before {
        opacity: 1;
    }

    .relove-card:hover::after {
        transform: translateX(100%) skewX(-15deg);
    }

    .relove-card h5 {
        color: #ffffff;
        font-weight: 600;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Å –∂–∏–¥–∫–∏–º —Å—Ç–µ–∫–ª–æ–º */
    .relove-btn {
        background: var(--primary-gradient);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 1.5rem;
        font-weight: 600;
        padding: 0.9em 2.5em;
        font-size: 1.05em;
        box-shadow: 0 8px 25px rgba(233, 78, 119, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .relove-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        transition: 0.6s;
    }

    .relove-btn:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 12px 35px rgba(233, 78, 119, 0.6), var(--accent-glow), inset 0 1px 0 rgba(255, 255, 255, 0.5);
        border-color: rgba(255, 255, 255, 0.6);
    }

    .relove-btn:hover::before {
        left: 100%;
    }

    .relove-btn:active {
        transform: translateY(-1px) scale(1.02);
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ —Å –∂–∏–¥–∫–∏–º —Å—Ç–µ–∫–ª–æ–º */
    .relove-tabs {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: 1px solid var(--glass-border);
        border-radius: 1.8rem;
        overflow: hidden;
        margin-bottom: 2.5rem;
        box-shadow: var(--glass-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.2);
        position: relative;
        z-index: 1;
    }

    .relove-tabs::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
        transform: translateX(-100%);
        transition: transform 0.8s ease;
    }

    .relove-tabs:hover::before {
        transform: translateX(100%);
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ */
    .chart-container {
        position: relative;
        margin: auto;
        height: 300px;
        width: 100%;
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-radius: 1rem;
        padding: 1rem;
        transition: all 0.3s ease;
    }

    .chart-container:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.2);
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .container {
        position: relative;
        z-index: 1;
    }

    /* reLove —Ñ–∏—Ä–º–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ */
    .relove-card {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: 1px solid var(--glass-border);
        border-radius: 1.6rem;
        box-shadow: var(--glass-shadow);
        padding: 1.8rem;
        margin-bottom: 2rem;
        color: #1a1a1a;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .relove-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .relove-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.2);
    }

    .relove-card:hover::before {
        opacity: 1;
    }

    /* –ê–∫—Ü–µ–Ω—Ç–Ω–æ–µ —Å–µ—Ä–¥–µ—á–∫–æ */
    .relove-heart {
        color: #e94e77;
        font-size: 1.6em;
        vertical-align: middle;
        filter: drop-shadow(0 2px 4px rgba(233, 78, 119, 0.2));
        font-family: 'Pacifico', cursive, sans-serif;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    .dashboard-title-bar {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: 1px solid var(--glass-border);
        border-radius: 2.5rem;
        box-shadow: var(--glass-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        padding: 1.8rem 2.5rem;
        margin: 0 0 2.5rem 0;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        min-height: 80px;
        position: relative;
        overflow: hidden;
        z-index: 1;
    }

    .dashboard-title-bar::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(233, 78, 119, 0.2), rgba(183, 33, 255, 0.2));
        opacity: 0.3;
        z-index: 0;
    }

    .dashboard-title-bar::after {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        animation: shimmer 8s linear infinite;
        z-index: 0;
    }

    @keyframes shimmer {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
    }

    .dashboard-title {
        color: #ffffff;
        font-size: 2.5rem;
        font-weight: 700;
        letter-spacing: 0.02em;
        position: relative;
        z-index: 1;
        display: flex;
        align-items: center;
        text-shadow: 0 4px 15px rgba(0, 0, 0, 0.3), 0 0 30px rgba(233, 78, 119, 0.5);
    }

    .dashboard-title .relove-heart {
        margin-left: 0.5rem;
        font-size: 2.1rem;
        vertical-align: middle;
        filter: drop-shadow(0 1px 4px rgba(233,78,119,0.13));
    }

    /* –í–∫–ª–∞–¥–∫–∏ —Å –∂–∏–¥–∫–∏–º —Å—Ç–µ–∫–ª–æ–º */
    .relove-tab-btn {
        color: rgba(255, 255, 255, 0.8);
        border: none;
        padding: 1.3rem 2.2rem;
        font-weight: 500;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        background: transparent;
        position: relative;
        overflow: hidden;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .relove-tab-btn::before {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 0;
        height: 3px;
        background: var(--primary-gradient);
        transition: all 0.4s ease;
        transform: translateX(-50%);
        box-shadow: var(--accent-glow);
    }

    .relove-tab-btn::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
        opacity: 0;
        transition: opacity 0.4s ease;
    }

    .relove-tab-btn:hover {
        color: #ffffff;
        background: rgba(255, 255, 255, 0.1);
    }

    .relove-tab-btn:hover::before {
        width: 80%;
    }

    .relove-tab-btn:hover::after {
        opacity: 1;
    }

    .relove-tab-btn.active {
        background: linear-gradient(135deg, rgba(233, 78, 119, 0.3), rgba(183, 33, 255, 0.3));
        color: #ffffff;
        font-weight: 600;
        box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.2);
    }

    .relove-tab-btn.active::before {
        width: 100%;
    }

    .relove-tab-btn.active::after {
        opacity: 1;
    }

    /* –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∂–∏–¥–∫–∏–º —Å—Ç–µ–∫–ª–æ–º */
    .stat-card {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: 1px solid var(--glass-border);
        border-radius: 1.5rem;
        padding: 2rem;
        margin-bottom: 1.5rem;
        box-shadow: var(--glass-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.2);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
        opacity: 0;
        transition: opacity 0.4s ease;
    }

    .stat-card:hover {
        transform: translateY(-5px) scale(1.03);
        box-shadow: 0 15px 50px 0 rgba(31, 38, 135, 0.4), var(--accent-glow);
        background: var(--glass-bg-hover);
    }

    .stat-card:hover::before {
        opacity: 1;
    }

    .stat-card .title {
        font-size: 0.95rem;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        font-weight: 500;
    }

    .stat-card .value {
        font-size: 2.5rem;
        font-weight: 700;
        color: #ffffff;
        background: var(--primary-gradient);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 30px rgba(233, 78, 119, 0.5);
        filter: drop-shadow(0 4px 10px rgba(233, 78, 119, 0.3));
    }

    /* –§–æ—Ä–º—ã –∏ –∏–Ω–ø—É—Ç—ã —Å –∂–∏–¥–∫–∏–º —Å—Ç–µ–∫–ª–æ–º */
    .form-control, .form-select {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: 1px solid var(--glass-border);
        border-radius: 1.2rem;
        padding: 1rem 1.5rem;
        transition: all 0.4s ease;
        color: #ffffff;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .form-control::placeholder {
        color: rgba(255, 255, 255, 0.6);
    }

    .form-control:focus, .form-select:focus {
        background: var(--glass-bg-hover);
        border-color: rgba(233, 78, 119, 0.8);
        box-shadow: 0 0 0 0.3rem rgba(233, 78, 119, 0.25), var(--accent-glow);
        outline: none;
        color: #ffffff;
    }

    .form-select {
        color: #ffffff;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
    }

    .form-select option {
        background: rgba(26, 26, 26, 0.95);
        color: #ffffff;
    }

    /* –¢–∞–±–ª–∏—Ü–∞ —Å –∂–∏–¥–∫–∏–º —Å—Ç–µ–∫–ª–æ–º */
    .table {
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-radius: 1.5rem;
        overflow: hidden;
        border: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow);
    }

    .table thead th {
        background: linear-gradient(135deg, rgba(233, 78, 119, 0.3), rgba(183, 33, 255, 0.3));
        border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        color: #ffffff;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        padding: 1.2rem 1rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .table tbody tr {
        transition: all 0.3s ease;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .table tbody tr:hover {
        background: rgba(233, 78, 119, 0.15);
        transform: scale(1.01);
    }

    .table tbody td {
        color: rgba(255, 255, 255, 0.95);
        padding: 1rem;
    }

    .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
    }

    .user-avatar:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .user-avatar-placeholder {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: rgba(255, 255, 255, 0.8);
        border: 2px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
    }

    .user-avatar-placeholder:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        border: 2px solid rgba(255, 255, 255, 0.2);
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.1));
    }

    .table td {
        vertical-align: middle;
        padding: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
    }

    .table tr:hover td {
        background: rgba(255, 255, 255, 0.05);
    }

    .table {
        border-collapse: separate;
        border-spacing: 0;
        width: 100%;
        margin-bottom: 1rem;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 10px;
        overflow: hidden;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }

    .table thead th {
        background: rgba(255, 255, 255, 0.05);
        color: rgba(255, 255, 255, 0.8);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding: 1rem;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
    }
    /* –ì–∞–ª–µ—Ä–µ—è —é–∑–µ—Ä–ø–∏–∫–æ–≤ */
    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: 16px;
    }
    .gallery-card {
        position: relative;
        border-radius: 16px;
        overflow: hidden;
        background: var(--glass-bg);
        border: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow);
        aspect-ratio: 1/1;
    }
    .gallery-img, .gallery-placeholder {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }
    .gallery-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 28px;
        background: linear-gradient(135deg, rgba(233, 78, 119, 0.15), rgba(127, 83, 172, 0.15));
        color: #1a1a1a;
    }
    .gallery-overlay {
        position: absolute;
        left: 0; right: 0; bottom: 0;
        padding: 10px 12px;
        background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.45) 60%, rgba(0,0,0,0.7) 100%);
        color: #fff;
        transform: translateY(0%);
        transition: transform 0.25s ease;
    }
    .gallery-card:hover .gallery-overlay { transform: translateY(0); }
    .gallery-name { font-weight: 700; font-size: 0.95rem; }
    .gallery-meta { font-size: 0.8rem; opacity: 0.9; }
    .gallery-summary { font-size: 0.8rem; opacity: 0.95; margin-top: 4px; max-height: 3.2em; overflow: hidden; }
    .gallery-loader { text-align: center; padding: 16px; color: #666; }

    /* –ü–ª–∞—à–∫–∏ –≤–æ –≤–∫–ª–∞–¥–∫–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∂–∏–¥–∫–∏–º —Å—Ç–µ–∫–ª–æ–º */
    .users-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }
    .user-card {
        display: flex;
        gap: 15px;
        align-items: stretch;
        padding: 18px;
        border-radius: 20px;
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow), inset 0 1px 0 rgba(255, 255, 255, 0.2);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        min-height: 110px;
        position: relative;
        overflow: hidden;
    }
    .user-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
        opacity: 0;
        transition: opacity 0.4s ease;
    }
    .user-card:hover { 
        transform: translateY(-5px) scale(1.02); 
        box-shadow: 0 15px 50px rgba(31,38,135,0.4), var(--accent-glow);
        background: var(--glass-bg-hover);
    }
    .user-card:hover::before {
        opacity: 1;
    }
    .user-card .avatar {
        width: 80px; height: 80px; border-radius: 16px; overflow: hidden; flex: 0 0 auto;
        display: flex; align-items: center; justify-content: center; 
        background: linear-gradient(135deg, rgba(233, 78, 119, 0.3), rgba(183, 33, 255, 0.3));
        font-weight: 700; font-size: 28px; color: #ffffff;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        border: 2px solid rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }
    .user-card .avatar img { 
        width: 100%; height: 100%; object-fit: cover; display: block;
        border-radius: 14px;
    }
    .user-card .content { flex: 1 1 auto; min-width: 0; position: relative; z-index: 1; }
    .user-card .name { 
        font-weight: 700; margin: 0; font-size: 1.05rem; color: #ffffff;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }
    .user-card .meta { 
        font-size: .9rem; color: rgba(255, 255, 255, 0.8); margin-top: 4px;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }
    .user-card .summary { 
        font-size: .88rem; color: rgba(255, 255, 255, 0.85); margin-top: 8px; 
        max-height: 3.5em; overflow: hidden; line-height: 1.4;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }
    .user-card .actions { 
        display: flex; gap: 8px; align-items: center; margin-left: 10px;
        position: relative; z-index: 1;
    }
    .user-card .actions button {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }
    .user-card .actions button:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
    </style>
</head>
<body>
    <!-- –ü–ª–∞–≤–∞—é—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ–Ω–∞ -->
    <div class="floating-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="container py-3">
        <div class="dashboard-title-bar mb-4">
            <span class="dashboard-title">reLove –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å <span class="relove-heart">‚ù§</span></span>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <ul class="nav nav-tabs mb-3 relove-tabs" id="dashboardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link relove-tab-btn active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">–û–±–∑–æ—Ä</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link relove-tab-btn" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            </li>
            
            <li class="nav-item" role="presentation">
                <button class="nav-link relove-tab-btn" id="streams-tab" data-bs-toggle="tab" data-bs-target="#streams" type="button" role="tab">–ü–æ—Ç–æ–∫–∏</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link relove-tab-btn" id="psychology-tab" data-bs-toggle="tab" data-bs-target="#psychology" type="button" role="tab">–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link relove-tab-btn" id="automation-tab" data-bs-toggle="tab" data-bs-target="#automation" type="button" role="tab">–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è</button>
            </li>
        </ul>

        <div class="tab-content" id="dashboardTabsContent">
            <!-- –í–∫–ª–∞–¥–∫–∞ "–û–±–∑–æ—Ä" -->
            <div class="tab-pane fade show active" id="overview" role="tabpanel">
                <div class="row">
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="title">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                            <div class="value">{{ total_users }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="title">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ–≥–æ–¥–Ω—è</div>
                            <div class="value">{{ active_users_today }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="title">–ù–æ–≤—ã—Ö –∑–∞ –Ω–µ–¥–µ–ª—é</div>
                            <div class="value">{{ new_users_week }}</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="title">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ</div>
                            <div class="value">{{ analyzed_users }}</div>
                        </div>
                    </div>
                </div>

                <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="relove-card">
                            <h5>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ—Ç–æ–∫–∞–º</h5>
                            <div class="chart-container">
                                <canvas id="streamsChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="relove-card">
                            <h5>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É</h5>
                            <div class="chart-container">
                                <canvas id="genderChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="relove-card">
                            <h5>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</h5>
                            <div class="chart-container">
                                <canvas id="activityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ "–ì–∞–ª–µ—Ä–µ—è" -->
            

            <!-- –í–∫–ª–∞–¥–∫–∞ "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" -->
            <div class="tab-pane fade" id="users" role="tabpanel">
                <div class="relove-card">
                    <h5>–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã</h5>
                    
                    <!-- –ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
                    <div class="mb-3">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-sm relove-btn" onclick="filterUsers('all')">–í—Å–µ</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="filterUsers('male')">üë® –ú—É–∂—á–∏–Ω—ã</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="filterUsers('female')">üë© –ñ–µ–Ω—â–∏–Ω—ã</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="filterUsers('with_profile')">‚úÖ –° –ø—Ä–æ—Ñ–∏–ª–µ–º</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="filterUsers('with_photo')">üì∑ –° —Ñ–æ—Ç–æ</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="filterUsers('active')">üü¢ –ê–∫—Ç–∏–≤–Ω—ã–µ</button>
                        </div>
                    </div>

                    <!-- –ü–æ–∏—Å–∫ -->
                    <div class="mb-3">
                        <div class="input-group">
                            <input type="text" class="form-control" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, username –∏–ª–∏ ID..." onkeyup="searchUsers()">
                            <button class="btn btn-outline-secondary" type="button" onclick="clearSearch()">
                                <span>‚úï</span>
                            </button>
                        </div>
                    </div>

                    <div id="usersGrid" class="users-grid"></div>
                    <div id="usersLoader" class="gallery-loader">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ "–ü–æ—Ç–æ–∫–∏" -->
            <div class="tab-pane fade" id="streams" role="tabpanel">
                <div class="row">
                    {% for stream in ['–ú—É–∂—Å–∫–æ–π', '–ñ–µ–Ω—Å–∫–∏–π', '–°–º–µ—à–∞–Ω–Ω—ã–π', '–ü—É—Ç—å –ì–µ—Ä–æ—è'] %}
                    <div class="col-md-6">
                        <div class="relove-card">
                            <h5>{{ stream }}</h5>
                            <div class="mb-3">
                                <strong>–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</strong> {{ stream_stats[stream].participants }}
                            </div>
                            <div class="mb-3">
                                <strong>–ê–∫—Ç–∏–≤–Ω—ã—Ö:</strong> {{ stream_stats[stream].active }}
                            </div>
                            <div class="mb-3">
                                <strong>–ó–∞–≤–µ—Ä—à–∏–ª–∏:</strong> {{ stream_stats[stream].completed }}
                            </div>
                            <button class="btn relove-btn" onclick="showStreamDetails('{{ stream }}')">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ "–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è" -->
            <div class="tab-pane fade" id="psychology" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="relove-card">
                            <h5>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Å–∏—Ö–æ—Ç–∏–ø–æ–≤</h5>
                            <div class="chart-container">
                                <canvas id="psychotypesChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="relove-card">
                            <h5>–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</h5>
                            <div class="chart-container">
                                <canvas id="emotionsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="relove-card">
                            <h5>–ú–∞—Å—Å–æ–≤—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h5>
                            <form method="post" action="/dashboard/analyze_all">
                                <button type="submit" class="btn relove-btn">–ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
                            </form>
                            <div class="mt-3">
                                <span class="badge bg-secondary">–°—Ç–∞—Ç—É—Å: {{ analysis_status|default('–ù–µ –∑–∞–ø—É—â–µ–Ω–æ') }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ "–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è" -->
            <div class="tab-pane fade" id="automation" role="tabpanel">
                <div class="relove-card">
                    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏</h3>
                    <form id="automationForm" class="mt-4">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="autoAnalysis">
                            <label class="form-check-label" for="autoAnalysis">
                                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                            </label>
                            <small class="form-text text-muted d-block">
                                –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏ –∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                            </small>
                        </div>
                        
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="autoReminders">
                            <label class="form-check-label" for="autoReminders">
                                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
                            </label>
                            <small class="form-text text-muted d-block">
                                –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
                            </small>
                        </div>
                        
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="autoStreams">
                            <label class="form-check-label" for="autoStreams">
                                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–∞–º–∏
                            </label>
                            <small class="form-text text-muted d-block">
                                –°–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –ø–æ—Ç–æ–∫–∞–º
                            </small>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        </button>
                    </form>
                </div>
                
                <div class="relove-card">
                    <h3>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏</h3>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>–ó–∞–¥–∞—á–∞</th>
                                    <th>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>–ê–Ω–∞–ª–∏–∑ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</td>
                                    <td>–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00</td>
                                    <td><span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω–æ</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-warning">
                                            <i class="fas fa-pause"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π</td>
                                    <td>–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00</td>
                                    <td><span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω–æ</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-warning">
                                            <i class="fas fa-pause"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤</td>
                                    <td>–ö–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é –≤ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</td>
                                    <td><span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω–æ</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-warning">
                                            <i class="fas fa-pause"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            // –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –ø–æ—Ç–æ–∫–∞–º
            const streamLabels = JSON.parse('{{ stream_labels|tojson|safe }}');
            const streamCounts = JSON.parse('{{ stream_counts|tojson|safe }}');
            new Chart(document.getElementById('streamsChart'), {
                type: 'pie',
                data: {
                    labels: streamLabels,
                    datasets: [{
                        data: streamCounts,
                        backgroundColor: ['#e94e77', '#7f53ac', '#36d1c4', '#ff9966']
                    }]
                }
            });

            // –ì—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –ø–æ–ª—É
            const genderData = {
                labels: ['–ú—É–∂—Å–∫–æ–π', '–ñ–µ–Ω—Å–∫–∏–π', '–ù–µ —É–∫–∞–∑–∞–Ω'],
                datasets: [{
                    data: [
                        parseInt('{{ male_count }}'),
                        parseInt('{{ female_count }}'),
                        parseInt('{{ unknown_count }}')
                    ],
                    backgroundColor: ['#36d1c4', '#e94e77', '#7f53ac']
                }]
            };
            new Chart(document.getElementById('genderChart'), {
                type: 'pie',
                data: genderData,
                options: {
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // –ì—Ä–∞—Ñ–∏–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            const activityLabels = JSON.parse('{{ activity_labels|tojson|safe }}');
            const activityData = JSON.parse('{{ activity_data|tojson|safe }}');
            new Chart(document.getElementById('activityChart'), {
                type: 'line',
                data: {
                    labels: activityLabels,
                    datasets: [{
                        label: '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å',
                        data: activityData,
                        borderColor: '#e94e77',
                        tension: 0.4
                    }]
                }
            });

            // –ì—Ä–∞—Ñ–∏–∫ –ø—Å–∏—Ö–æ—Ç–∏–ø–æ–≤
            const psychotypeLabels = JSON.parse('{{ psychotype_labels|tojson|safe }}');
            const psychotypeCounts = JSON.parse('{{ psychotype_counts|tojson|safe }}');
            new Chart(document.getElementById('psychotypesChart'), {
                type: 'bar',
                data: {
                    labels: psychotypeLabels,
                    datasets: [{
                        label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
                        data: psychotypeCounts,
                        backgroundColor: '#7f53ac'
                    }]
                }
            });

            // –ì—Ä–∞—Ñ–∏–∫ —ç–º–æ—Ü–∏–π
            const emotionLabels = JSON.parse('{{ emotion_labels|tojson|safe }}');
            const emotionData = JSON.parse('{{ emotion_data|tojson|safe }}');
            new Chart(document.getElementById('emotionsChart'), {
                type: 'radar',
                data: {
                    labels: emotionLabels,
                    datasets: [{
                        label: '–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å',
                        data: emotionData,
                        backgroundColor: 'rgba(233,78,119,0.2)',
                        borderColor: '#e94e77'
                    }]
                }
            });
        });

        // –õ–µ–Ω–∏–≤–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–æ –≤–∫–ª–∞–¥–∫–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
        const usersGrid = document.getElementById('usersGrid');
        const usersLoader = document.getElementById('usersLoader');
        let usersOffset = 0;
        const usersLimit = 36;
        let usersLoading = false;
        let usersEnded = false;
        let allUsers = []; // –ö—ç—à –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        let currentFilter = 'all';
        let currentSearch = '';

        // –§—É–Ω–∫—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        function filterUsers(filterType) {
            currentFilter = filterType;
            applyFilters();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.btn-group button').forEach(btn => {
                btn.classList.remove('relove-btn');
                btn.classList.add('btn-outline-secondary');
            });
            event.target.classList.remove('btn-outline-secondary');
            event.target.classList.add('relove-btn');
        }

        function searchUsers() {
            currentSearch = document.getElementById('searchInput').value.toLowerCase();
            applyFilters();
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            currentSearch = '';
            applyFilters();
        }

        function applyFilters() {
            let filtered = allUsers;

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É
            if (currentFilter !== 'all') {
                filtered = filtered.filter(user => {
                    switch(currentFilter) {
                        case 'male': return user.gender === 'male';
                        case 'female': return user.gender === 'female';
                        case 'with_profile': return user.profile && user.profile.trim().length > 0;
                        case 'with_photo': return user.photo_jpeg && user.photo_jpeg.length > 0;
                        case 'active': return user.is_active === true;
                        default: return true;
                    }
                });
            }

            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∏—Å–∫
            if (currentSearch) {
                filtered = filtered.filter(user => {
                    const searchStr = `${user.first_name || ''} ${user.last_name || ''} ${user.username || ''} ${user.id}`.toLowerCase();
                    return searchStr.includes(currentSearch);
                });
            }

            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º
            usersGrid.innerHTML = '';
            renderUserCards(filtered);
            
            if (filtered.length === 0) {
                usersGrid.innerHTML = '<div class="gallery-loader">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
            }
        }

        function renderUserCards(items) {
            const frag = document.createDocumentFragment();
            items.forEach(user => {
                const card = document.createElement('div');
                card.className = 'user-card';
                const initials = (user.first_name || user.username || '?').trim().slice(0,1).toUpperCase();
                const avatar = user.photo_jpeg
                    ? `<img src="data:image/jpeg;base64,${user.photo_jpeg}" alt="${user.first_name||''}">`
                    : initials;
                const username = user.username ? '@' + user.username : '';
                const genderIcon = user.gender === 'male' ? 'üë®' : user.gender === 'female' ? 'üë©' : '';
                const summary = (user.profile || '').toString().substring(0, 150);
                card.innerHTML = `
                    <div class="avatar">${avatar}</div>
                    <div class="content">
                        <p class="name">${user.first_name || ''} ${user.last_name || ''} <span class="text-muted">${username}</span></p>
                        <div class="meta">${genderIcon} ${user.gender || ''}</div>
                        <div class="summary">${summary}</div>
                    </div>
                    <div class="actions">
                        <button class="btn btn-sm btn-primary" onclick="showUserDetails('${user.id}')" title="–î–µ—Ç–∞–ª–∏">üëÅÔ∏è</button>
                    </div>
                `;
                frag.appendChild(card);
            });
            usersGrid.appendChild(frag);
        }

        async function loadMoreUsers() {
            if (usersLoading || usersEnded) return;
            usersLoading = true;
            usersLoader.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
            try {
                const resp = await fetch(`/api/users?offset=${usersOffset}&limit=${usersLimit}`);
                const data = await resp.json();
                if (!Array.isArray(data) || data.length === 0) {
                    usersEnded = true;
                    usersLoader.textContent = '–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã';
                    return;
                }
                allUsers = allUsers.concat(data);
                applyFilters();
                usersOffset += data.length;
                usersLoader.textContent = '–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –Ω–∏–∂–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –µ—â—ë';
            } catch (e) {
                usersLoader.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
                console.error(e);
            } finally {
                usersLoading = false;
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—É—é –ø–æ—Ä—Ü–∏—é –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–∫–∞–∑–µ –≤–∫–ª–∞–¥–∫–∏ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
        const usersTab = document.getElementById('users-tab');
        let usersInitialized = false;
        if (usersTab) {
            usersTab.addEventListener('shown.bs.tab', () => {
                if (!usersInitialized) {
                    usersInitialized = true;
                    loadMoreUsers();
                }
            });
        }
        // –ï—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –≥—Ä—É–∑–∏–º —Å—Ä–∞–∑—É
        document.addEventListener('DOMContentLoaded', () => {
            const tabEl = document.querySelector('#users');
            if (tabEl && tabEl.classList.contains('active')) {
                loadMoreUsers();
            }
        });

        const usersIO = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    loadMoreUsers();
                }
            });
        }, { root: null, rootMargin: '600px', threshold: 0 });

        if (usersLoader) usersIO.observe(usersLoader);

        function showUserDetails(userId) {
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            console.log('–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId);
        }

        function analyzeUser(userId) {
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            console.log('–ê–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', userId);
        }

        function showStreamDetails(stream) {
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π –ø–æ—Ç–æ–∫–∞
            console.log('–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –ø–æ—Ç–æ–∫–∞:', stream);
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
        async function analyzeUser(userId) {
            try {
                const response = await fetch(`/api/user/${userId}/analyze`);
                const data = await response.json();
                if (response.ok) {
                    showAnalysisModal(data);
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            }
        }

        async function viewUserDetails(userId) {
            try {
                const response = await fetch(`/api/user/${userId}/details`);
                const data = await response.json();
                if (response.ok) {
                    showUserDetailsModal(data);
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            }
        }

        async function updateUserStatus(userId, status) {
            try {
                const response = await fetch(`/api/user/${userId}/status`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status })
                });
                const data = await response.json();
                if (response.ok) {
                    showSuccess('–°—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω');
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    const statusBadge = document.querySelector(`#user-${userId} .status-badge`);
                    if (statusBadge) {
                        statusBadge.className = `status-badge ${status === 'active' ? 'bg-success' : 'bg-danger'}`;
                        statusBadge.textContent = status === 'active' ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω';
                    }
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞');
            }
        }

        async function manageStreams(userId, streamName, action) {
            try {
                const response = await fetch('/api/streams/manage', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        stream_name: streamName,
                        action: action
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showSuccess(`–ü–æ—Ç–æ–∫ ${action === 'add' ? '–¥–æ–±–∞–≤–ª–µ–Ω' : '—É–¥–∞–ª–µ–Ω'}`);
                    // –û–±–Ω–æ–≤–ª—è–µ–º UI
                    const streamsList = document.querySelector(`#user-${userId} .streams-list`);
                    if (streamsList) {
                        streamsList.textContent = data.streams.join(', ');
                    }
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø–æ—Ç–æ–∫–∞–º–∏');
            }
        }

        async function getAutomationSettings() {
            try {
                const response = await fetch('/api/automation/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ action: 'get' })
                });
                const data = await response.json();
                if (response.ok) {
                    return data;
                } else {
                    showError(data.error);
                    return null;
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏');
                return null;
            }
        }

        async function updateAutomationSettings(settings) {
            try {
                const response = await fetch('/api/automation/settings', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'update',
                        settings: settings
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    showSuccess('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏');
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è UI
        function showAnalysisModal(data) {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">–ê–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p><strong>–ü—Å–∏—Ö–æ—Ç–∏–ø:</strong> ${data.psychotype}</p>
                            <p><strong>–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:</strong> ${data.emotional_state}</p>
                            <p><strong>–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</strong> ${data.activity_level}</p>
                            <p><strong>–ò–Ω—Ç–µ—Ä–µ—Å—ã:</strong> ${data.interests.join(', ')}</p>
                            <p><strong>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</strong> ${data.recommendations.join(', ')}</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            new bootstrap.Modal(modal).show();
        }

        function showUserDetailsModal(data) {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">–î–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p><strong>ID:</strong> ${data.id}</p>
                            <p><strong>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong> ${data.username}</p>
                            <p><strong>–ò–º—è:</strong> ${data.first_name}</p>
                            <p><strong>–§–∞–º–∏–ª–∏—è:</strong> ${data.last_name}</p>
                            <p><strong>–ü–æ–ª:</strong> ${data.gender}</p>
                            <p><strong>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong> ${data.registration_date}</p>
                            <p><strong>–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</strong> ${data.last_activity}</p>
                            <p><strong>–ü–æ—Ç–æ–∫–∏:</strong> ${data.streams.join(', ')}</p>
                            <p><strong>–ü—Å–∏—Ö–æ—Ç–∏–ø:</strong> ${data.psychotype}</p>
                            <p><strong>–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:</strong> ${data.emotional_state}</p>
                            <p><strong>–£—Ä–æ–≤–µ–Ω—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:</strong> ${data.activity_level}</p>
                            <p><strong>–†–µ–∑—é–º–µ –ø—Ä–æ—Ñ–∏–ª—è:</strong> ${data.profile_summary}</p>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${data.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}</p>
                            <p><strong>–ó–∞–≤–µ—Ä—à–µ–Ω:</strong> ${data.completed ? '–î–∞' : '–ù–µ—Ç'}</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            new bootstrap.Modal(modal).show();
        }

        function showSuccess(message) {
            const toast = document.createElement('div');
            toast.className = 'toast align-items-center text-white bg-success border-0';
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            document.body.appendChild(toast);
            new bootstrap.Toast(toast).show();
        }

        function showError(message) {
            const toast = document.createElement('div');
            toast.className = 'toast align-items-center text-white bg-danger border-0';
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">${message}</div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            document.body.appendChild(toast);
            new bootstrap.Toast(toast).show();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', async () => {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
            const automationSettings = await getAutomationSettings();
            if (automationSettings) {
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
                document.getElementById('autoAnalysis').checked = automationSettings.auto_analysis || false;
                document.getElementById('autoReminders').checked = automationSettings.auto_reminders || false;
                document.getElementById('autoStreams').checked = automationSettings.auto_streams || false;
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ñ–æ—Ä–º
            document.getElementById('automationForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const settings = {
                    auto_analysis: document.getElementById('autoAnalysis').checked,
                    auto_reminders: document.getElementById('autoReminders').checked,
                    auto_streams: document.getElementById('autoStreams').checked
                };
                await updateAutomationSettings(settings);
            });
        });

        
    </script>
</body>
</html>
