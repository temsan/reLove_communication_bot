<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Админка reLove</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: #fff;
      color: #1a1a1a;
      margin: 0;
      padding: 0;
    }

/* reLove фирменные карточки */
.relove-card {
  background: #fff;
  border-radius: 1.6rem;
  box-shadow: 0 2px 16px 0 rgba(127,83,172,0.09);
  border: 2.5px solid transparent;
  background-clip: padding-box;
  padding: 1.4rem 1.8rem 1.3rem 1.8rem;
  margin-bottom: 2rem;
  color: #1a1a1a;
  transition: box-shadow 0.2s, border 0.2s;
  position: relative;
}
.relove-card.accent-1 { border-image: linear-gradient(90deg, #e94e77, #b721ff) 1; }
.relove-card.accent-2 { border-image: linear-gradient(90deg, #36d1c4, #7f53ac) 1; }
.relove-card.accent-3 { border-image: linear-gradient(90deg, #d72660, #ffaf7b) 1; }
.relove-card:hover { box-shadow: 0 16px 48px 0 rgba(215,38,96,0.13); }

/* Кнопки reLove */
.relove-btn {
  background: linear-gradient(90deg, #e94e77 0%, #b721ff 100%);
  color: #fff;
  border: none;
  border-radius: 1.2rem;
  font-weight: 600;
  padding: 0.7em 2.1em;
  font-size: 1.1em;
  box-shadow: 0 2px 12px 0 rgba(127,83,172,0.09);
  transition: background 0.2s, box-shadow 0.2s;
}
.relove-btn:hover {
  background: linear-gradient(90deg, #d72660 0%, #7f53ac 100%);
  box-shadow: 0 8px 24px 0 rgba(233,78,119,0.13);
}

/* Акцентное сердечко */
.relove-heart {
  color: #e94e77;
  font-size: 1.6em;
  vertical-align: middle;
  filter: drop-shadow(0 1px 4px rgba(233,78,119,0.13));
  font-family: 'Pacifico', cursive, sans-serif;
}

    .dashboard-title-bar {
      background: linear-gradient(90deg, #ff9966 0%, #b721ff 100%);
      border-radius: 2rem;
      box-shadow: 0 2px 16px 0 rgba(127,83,172,0.09);
      padding: 1.1rem 1.6rem 1.1rem 2.1rem;
      margin: 0 0 2rem 0;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      min-height: 68px;
    }
    .dashboard-title {
  color: #fff;
  font-size: 2.2rem;
  font-family: 'Inter', Arial, sans-serif;
  font-weight: 700;
  letter-spacing: 0.01em;
  text-shadow: none;
  display: flex;
  align-items: center;
}
.dashboard-title .relove-heart {
  margin-left: 0.5rem;
  font-size: 2.1rem;
  vertical-align: middle;
  filter: drop-shadow(0 1px 4px rgba(233,78,119,0.13));
}
    .relove-tabs .nav-link.relove-tab-btn {
      border: none;
      background: none;
      color: #7f53ac;
      font-weight: 500;
      border-radius: 0;
      padding: 0.7rem 1.2rem;
      transition: color 0.2s;
    }
    .relove-tabs .nav-link.relove-tab-btn.active {
      color: #fff;
      background: #7f53ac;
      border-radius: 1.2rem 1.2rem 0 0;
    }
    .modern-users-grid {
      background: none;
      padding: 0;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 1.2rem;
      max-width: 1200px;
    }
    .modern-user-card {
      background: #fff;
      border-radius: 1.1rem;
      box-shadow: 0 1px 7px 0 rgba(127,83,172,0.06);
      border: 1px solid #f1f1f4;
      transition: box-shadow 0.14s, border-color 0.10s;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 300px;
    }
    .modern-user-card:hover {
      box-shadow: 0 6px 20px 0 rgba(127,83,172,0.09);
      border-color: #7f53ac;
    }
    .modern-user-photo-wrap {
      width: 100%;
      height: 250px;
      background: #f5f5fa;
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 1px solid #f1f1f4;
      overflow: hidden;
      position: relative;
    }
    .modern-user-photo {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 0.6rem;
      background: #f4f4f7;
      border: none;
      box-shadow: 0 1px 4px 0 rgba(127,83,172,0.03);
      transition: transform 0.3s ease;
    }
    .modern-user-photo-wrap:hover .modern-user-photo {
      transform: scale(1.1);
    }
    .modern-user-photo--empty {
      background: #f4f4f7;
      border: 1px dashed #e0e0e0;
      border-radius: 0.6rem;
      color: #bbb;
      font-size: 1.2rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 70%;
      height: 70%;
    }
    input[type='text'], .form-control {
      border-radius: 0.7rem;
      border: 1px solid #e0e0e0;
      background: #fafbfc;
      padding: 0.5rem 1rem;
      font-size: 1rem;
    }
    input[type='text']:focus, .form-control:focus {
      outline: none;
      border-color: #7f53ac;
      background: #fff;
    }
    button, .btn {
      border-radius: 0.7rem;
      background: #7f53ac;
      color: #fff;
      border: none;
      font-weight: 500;
      padding: 0.5rem 1.4rem;
      transition: background 0.18s;
    }
    button:hover, .btn:hover {
      background: #d72660;
      color: #fff;
    }
    .modern-user-info {
      width: 100%;
      padding: 0.3em 0.4em 0.3em 0.4em;
      background: transparent;
      text-align: left;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: flex-start;
      gap: 0.03em;
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.5));
    }
    .modern-user-name {
      font-size: 0.75em;
      font-weight: 500;
      color: #fff;
      margin-bottom: 0.03em;
      letter-spacing: 0.01em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    .modern-user-username {
      font-size: 0.78em;
      color: #7f53ac;
      opacity: 1;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    /* Tooltip саммари */
    .modern-user-summary-tooltip {
      display: none;
      position: absolute;
      left: 50%;
      top: -12px;
      transform: translate(-50%, -100%) scale(0.97);
      min-width: 120px;
      max-width: 220px;
      background: #fff;
      color: #222;
      border: 1px solid #ececf5;
      border-radius: 0.6rem;
      box-shadow: 0 2px 10px 0 rgba(127,83,172,0.07);
      padding: 0.3em 0.6em 0.3em 0.6em;
      z-index: 99;
      font-size: 0.90em;
      text-align: left;
      pointer-events: auto;
      opacity: 0;
      transition: opacity 0.13s, transform 0.18s;
      max-height: 180px;
      overflow-y: auto;
      word-break: break-word;
    }
    .modern-user-photo-wrap:hover .modern-user-summary-tooltip {
      display: block;
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -105%) scale(1);
      animation: fadeInSummaryModern 0.14s;
      margin-bottom: 2px;
      max-height: 400px;
    }
    @keyframes fadeInSummaryModern {
      from { opacity: 0; transform: translate(-50%, -100%) scale(0.96); }
      to { opacity: 1; transform: translate(-50%, -128%) scale(1); }
    }
    .modern-user-summary-label {
      color: #7f53ac;
      font-size: 0.85em;
      font-weight: 600;
      margin-bottom: 0.18em;
      letter-spacing: 0.01em;
    }
    .modern-user-summary-text {
      color: #222;
      font-size: 0.85em;
      font-weight: 400;
      white-space: pre-line;
      word-break: break-word;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      max-height: 3.8em;
    }
    .modern-user-summary-tooltip::after {
      content: '';
      position: absolute;
      left: 50%;
      top: 100%;
      transform: translateX(-50%) rotate(45deg);
      width: 10px;
      height: 10px;
      background: #fff;
      border-left: 1px solid #ececf5;
      border-bottom: 1px solid #ececf5;
      box-shadow: 0 1px 3px 0 rgba(127,83,172,0.04);
      border-radius: 0 0 0.3em 0;
      z-index: 100;
      pointer-events: none;
      clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
    }

.modern-user-card {
  background: #fff;
  color: #23232A;
  aspect-ratio: 0.7 / 1;
  width: 100%;
  min-width: 0;
  max-width: 540px;
  min-height: 0;
  max-height: 820px;
  margin: 0 auto;
  border-radius: 2.5rem;
  overflow: hidden;
  position: relative;
  box-shadow: 0 4px 24px 0 rgba(127,83,172,0.08);
  border: none;
  padding: 0;
  display: flex;
  flex-direction: column;
  justify-content: stretch;
  align-items: stretch;
}

.modern-user-summary {
  font-size: clamp(0.7rem, 0.9vw, 0.89rem);
  line-height: 1.19;
  color: #bfc3d9;
  font-weight: 400;
  padding: 0.7em 1em 1em 1em;
  word-break: break-word;
  overflow-wrap: break-word;
  overflow: visible;
  text-overflow: initial;
  min-height: 3.3em;
  max-height: none;
  display: block;
}

.user-photo-bg {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      filter: brightness(0.55);
      z-index: 0;
      transition: filter .2s;
      border-radius: 1.5rem;
      box-shadow: none;
      border: none;
    }
    .user-photo-bg--empty {
      background: linear-gradient(135deg, #e0e6fa 70%, #f8e1f6 100%);
    }
    .user-photo-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0.48) 60%, rgba(127,83,172,0.25) 100%);
      z-index: 1;
    }
    .user-photo-content {
      color: #fff !important;
      text-shadow: 0 2px 12px #000a;
      padding: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .user-photo-name, .user-photo-username, .user-photo-badge, .user-photo-summary-label, .user-photo-summary-text {
      color: #fff !important;
    }
    .user-photo-username {
      opacity: 0.92;
    }
    .user-photo-badge {
      background: rgba(127,83,172,0.55);
      color: #fff;
      border: none;
      font-weight: 500;
      font-size: 1.01rem;
      margin-bottom: 0.2rem;
    }
    .user-photo-summary-bubble {
      display: none;
      position: absolute;
      left: 100%;
      top: 50%;
      transform: translateY(-50%) scale(0.85);
      min-width: 270px;
      max-width: 400px;
      background: #fff;
      color: #222;
      border-radius: 1.2rem;
      box-shadow: 0 8px 32px 0 rgba(60,40,120,0.20);
      z-index: 20;
      padding: 1.4rem 1.4rem 1.2rem 1.4rem;
      text-align: left;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.16s, transform 0.18s;
      margin-left: 22px;
      font-size: 1.18rem;
    }
    .user-photo-card:hover .user-photo-summary-bubble {
      display: block;
      opacity: 1;
      pointer-events: auto;
      transform: translateY(-50%) scale(1);
      animation: bubbleGrow 0.18s;
    }
    @keyframes bubbleGrow {
      from { opacity: 0; transform: translateY(-50%) scale(0.85); }
      to   { opacity: 1; transform: translateY(-50%) scale(1); }
    }
    .user-photo-summary-bubble-arrow {
      position: absolute;
      left: -18px;
      top: 50%;
      transform: translateY(-50%);
      width: 28px;
      height: 28px;
      pointer-events: none;
      z-index: 21;
      overflow: visible;
    }
    .user-photo-summary-bubble-arrow::before {
      content: '';
      position: absolute;
      left: 6px;
      top: 50%;
      transform: translateY(-50%) rotate(-45deg);
      width: 20px;
      height: 20px;
      background: #fff;
      border-radius: 0 0 0 1rem;
      box-shadow: -2px 2px 10px 0 rgba(60,40,120,0.10);
      z-index: 22;
      border: 1.5px solid #e0e6fa;
    }
    .user-photo-summary-bubble-inner {
      width: 100%;
      max-height: 240px;
      overflow-y: auto;
    }
    .user-photo-summary-label {
      color: #7f53ac;
      font-size: 1.1rem;
      font-weight: 700;
      opacity: 1;
      margin-bottom: 0.7em;
      letter-spacing: 0.02em;
    }
    .user-photo-summary-text {
      color: #222;
      font-size: 1.13rem;
      opacity: 0.98;
      white-space: pre-line;
      word-break: break-word;
      font-weight: 400;
    }

    .dashboard-header {
        background: linear-gradient(90deg, #d72660 0%, #7f53ac 100%);
        color: #fff;
        border-radius: 1.5rem;
        box-shadow: 0 4px 24px 0 rgba(215,38,96,0.10);
        padding: 2.2rem 1.5rem 1.2rem 1.5rem;
        margin-bottom: 2rem;
        letter-spacing: 1px;
        position: relative;
    }
    .dashboard-header h1 {
        font-weight: 800;
        font-size: 2.5rem;
        letter-spacing: 2px;
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }
    .dashboard-header .relove-heart {
        font-size: 2.7rem;
        color: #fff;
        text-shadow: 0 2px 12px #d72660cc;
        margin-left: 0.2em;
        vertical-align: middle;
        animation: relove-heartbeat 1.2s infinite;
    }
    @keyframes relove-heartbeat {
        0%, 100% { transform: scale(1); }
        10% { transform: scale(1.15); }
        20% { transform: scale(0.92); }
        30% { transform: scale(1.12); }
        40% { transform: scale(0.98); }
        50% { transform: scale(1.1); }
        60% { transform: scale(0.96); }
        70% { transform: scale(1.04); }
        80% { transform: scale(0.98); }
        90% { transform: scale(1.02); }
    }
    .relove-card {
  background: linear-gradient(90deg, #e94e77 0%, #7f53ac 100%);
  border-radius: 1.6rem;
  box-shadow: 0 2px 16px 0 rgba(127,83,172,0.09);
  padding: 1.4rem 1.8rem 1.3rem 1.8rem;
  margin-bottom: 2rem;
  color: #fff;
  border: none;
  display: flex;
  flex-direction: column;
  min-height: 210px;
}
.relove-card-title {
  font-size: 1.35rem;
  font-weight: 700;
  margin-bottom: 1rem;
  color: #fff;
  letter-spacing: 0.01em;
  text-shadow: 0 1px 8px rgba(127,83,172,0.09);
}
.relove-card .btn,
.relove-btn, .btn.btn-danger, .btn.btn-success, .btn.btn-warning, .btn.btn-info, .btn.btn-primary, .btn.btn-secondary, .btn.btn-dark {
  background: #7f53ac;
  color: #fff;
  border-radius: 1.2rem;
  border: none;
  font-weight: 600;
  padding: 0.65rem 1.5rem;
  box-shadow: 0 1px 6px 0 rgba(127,83,172,0.08);
  transition: background 0.18s, box-shadow 0.18s;
}
.relove-card .btn:hover,
.relove-btn:hover, .btn.btn-danger:hover, .btn.btn-success:hover, .btn.btn-warning:hover, .btn.btn-info:hover, .btn.btn-primary:hover, .btn.btn-secondary:hover, .btn.btn-dark:hover {
  background: #e94e77;
  color: #fff;
  box-shadow: 0 3px 16px 0 rgba(127,83,172,0.13);
}
.relove-card .badge {
  background: rgba(255,255,255,0.14);
  color: #fff;
}
.relove-card {
  transition: transform .18s, box-shadow .18s;
  position: relative;
  overflow: visible;
  min-height: 120px;
  padding: 1.2rem 1rem 1.1rem 1rem;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
    .relove-card:hover {
        transform: translateY(-6px) scale(1.03);
        box-shadow: 0 16px 48px 0 rgba(215,38,96,0.18);
    }
    .relove-heart-frame {
        width: 82px; height: 74px;
        background: linear-gradient(135deg, #d72660 0%, #7f53ac 100%);
        clip-path: path('M41,74 C-10,44 0,10 41,29 C82,10 92,44 41,74 Z');
        display: flex; align-items: center; justify-content: center;
        margin-bottom: 1.2rem;
        box-shadow: 0 4px 16px 0 rgba(215,38,96,0.13);
        position: relative;
        z-index: 2;
        border: 3px solid #fff;
    }
    .relove-heart-frame img {
        width: 62px; height: 62px; object-fit: cover;
        border-radius: 50%;
        border: 3px solid #fff;
        box-shadow: 0 2px 8px 0 rgba(127,83,172,0.12);
    }
    .relove-username {
        font-family: 'Pacifico', cursive, sans-serif;
        color: #d72660;
        font-size: 1.1rem;
        margin-bottom: 0.4rem;
    }
    .relove-name {
        font-weight: 700;
        font-size: 1.3rem;
        color: #7f53ac;
        margin-bottom: 0.3rem;
    }
    .relove-badges .badge {
        margin: 0 0.15rem 0.3rem 0.15rem;
        font-size: 0.93rem;
        border-radius: 1rem;
        padding: 0.45em 1.1em;
    }
    .relove-badges .badge-gender {
        background: linear-gradient(90deg, #d72660 0%, #7f53ac 100%);
        color: #fff;
    }
    .relove-badges .badge-streams {
        background: linear-gradient(90deg, #fbb1b1 0%, #f8e1f6 100%);
        color: #d72660;
        border: 1px solid #fbb1b1;
    }
    .relove-badges .badge-posts {
        background: #e0e6fa;
        color: #7f53ac;
        border: 1px solid #e0e6fa;
    }
    .relove-summary-card {
        background: linear-gradient(120deg, #fff 60%, #f8e1f6 100%);
        border-radius: 1.2rem;
        box-shadow: 0 1px 8px 0 rgba(127,83,172,0.07);
        margin-top: 1.2rem;
        padding: 1rem 1.2rem 0.7rem 1.2rem;
        min-height: 85px;
        position: relative;
    }
    .relove-summary-card:before {
        content: '\2665';
        position: absolute;
        top: -18px; left: 14px;
        color: #d72660;
        font-size: 1.3rem;
        opacity: 0.18;
        z-index: 0;
    }
    .relove-summary-title {
        font-size: 0.97rem;
        color: #d72660;
        font-weight: 600;
        margin-bottom: 0.3rem;
        letter-spacing: 0.5px;
    }
    .relove-summary-text {
        color: #7f53ac;
        font-size: 1.05rem;
        white-space: pre-line;
        z-index: 2;
        position: relative;
    }
    .relove-heart-emoji {
        position: absolute;
        top: 8px; right: 18px;
        font-size: 1.6rem;
        opacity: 0.25;
        pointer-events: none;
    }
</style>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

<body>
<!-- Верхнее меню убрано по просьбе пользователя -->
<div style="height:58px;"></div>
<div class="container py-3">
    <div class="dashboard-title-bar mb-4">
        <span class="dashboard-title">Аналитика пользователей <span class="relove-heart">❤</span></span>
    </div>
    <!-- Вкладки -->
    <ul class="nav nav-tabs mb-3 relove-tabs" id="dashboardTabs" role="tablist" style="border-radius: 1.2rem; overflow: hidden; background: linear-gradient(90deg, #ffe1e1 0%, #f8e1f6 100%);">
      <li class="nav-item" role="presentation">
        <button class="nav-link relove-tab-btn active" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab" aria-controls="analytics" aria-selected="true">Аналитика</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link relove-tab-btn " id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab" aria-controls="users" aria-selected="false">Пользователи</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link relove-tab-btn " id="mailing-tab" data-bs-toggle="tab" data-bs-target="#mailing" type="button" role="tab" aria-controls="mailing" aria-selected="false">Рассылка</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link relove-tab-btn " id="automation-tab" data-bs-toggle="tab" data-bs-target="#automation" type="button" role="tab" aria-controls="automation" aria-selected="false">Автоматизация</button>
      </li>
    </ul>
    <div class="tab-content" id="dashboardTabsContent">
  <!-- Аналитика -->
  <div class="tab-pane fade show active" id="analytics" role="tabpanel" aria-labelledby="analytics-tab">
    <div class="row mb-4 justify-content-center g-3 flex-nowrap overflow-auto" style="gap: 1.5rem;">
      <div class="col-auto" style="min-width:200px;">
        <div class="card relove-card relove-metric text-center">
          <div class="card-body">
            <div class="relove-metric-icon">❤️</div>
            <div class="relove-metric-value">467</div>
            <div class="relove-metric-label">Пользователей</div>
          </div>
        </div>
      </div>
      <div class="col-auto" style="min-width:200px;">
        <div class="card relove-card relove-metric text-center">
          <div class="card-body">
            <div class="relove-metric-icon">♂️</div>
            <div class="relove-metric-value">290</div>
            <div class="relove-metric-label">Мужчин</div>
          </div>
        </div>
      </div>
      <div class="col-auto" style="min-width:200px;">
        <div class="card relove-card relove-metric text-center">
          <div class="card-body">
            <div class="relove-metric-icon">♀️</div>
            <div class="relove-metric-value">177</div>
            <div class="relove-metric-label">Женщин</div>
          </div>
        </div>
      </div>
      <div class="col-auto" style="min-width:200px;">
        <div class="card relove-card relove-metric text-center">
          <div class="card-body">
            <div class="relove-metric-icon">❓</div>
            <div class="relove-metric-value">0</div>
            <div class="relove-metric-label">Не указано</div>
          </div>
        </div>
      </div>
    </div>
    <div class="row g-4">
      <div class="col-12 col-lg-6">
        <div class="card chart-card">
          <div class="card-body">
            <h5 class="card-title">Распределение по полу</h5>
            <canvas id="gender-chart" style="max-height:340px;"></canvas>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="card chart-card">
          <div class="card-body">
            <h5 class="card-title">Распределение по потокам</h5>
            <canvas id="streams-chart" style="max-height:340px;"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Пользователи -->
  <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="users-tab">
    <form class="relove-form search-form mb-4" method="get" action="/admin/search">
      <div class="input-group">
        <input type="text" class="form-control" name="query" placeholder="ID, имя, username, поток..." style="border-radius: 1rem 0 0 1rem;">
        <button class="relove-btn" type="submit">Искать</button>
      </div>
    </form>
    <div class="modern-users-grid"></div>
    <style>
.user-list-grid-modern {
  width: 100%; margin:0 auto;
  display:grid; grid-template-columns:repeat(6,1fr);
  gap:8px; padding:0 0 12px 0; max-width:1200px;
}
@media (max-width:1200px) {
  .user-list-grid-modern { grid-template-columns:repeat(4,1fr); }
}
@media (max-width:900px) {
  .user-list-grid-modern { grid-template-columns:repeat(3,1fr); }
}
@media (max-width:600px) {
  .user-list-grid-modern { grid-template-columns:repeat(2,1fr); }
}
@media (max-width:400px) {
  .user-list-grid-modern { grid-template-columns:1fr; }
}
@media (min-width:700px) {
  .user-list-grid-modern { grid-template-columns:1fr 1fr; gap:28px; }
}
@media (min-width:1100px) {
  .user-list-grid-modern { grid-template-columns:repeat(3,1fr); }
}
</style>
  </div>
  <!-- Рассылка -->
  <div class="tab-pane fade" id="mailing" role="tabpanel" aria-labelledby="mailing-tab">
    <div class="row justify-content-center">
      <div class="col-md-7 col-lg-6">
        <form method="post" action="/admin/mailing" class="relove-form">
          <h5 class="mb-3">Создать рассылку</h5>
          <div class="mb-3">
            <label for="genderSelect" class="form-label">Пол</label>
            <select class="form-select" id="genderSelect" name="gender">
              <option value="">Любой</option>
              <option value="male">Мужской</option>
              <option value="female">Женский</option>
              <option value="unknown">Не указан</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="streamsSelect" class="form-label">Потоки</label>
            <select multiple class="form-select" id="streamsSelect" name="streams">
              
              <option value="Женский">Женский</option>
              
              <option value="Мужской">Мужской</option>
              
              <option value="Смешанный">Смешанный</option>
              
              <option value="Путь героя">Путь героя</option>
              
            </select>
            <div class="form-text">Можно выбрать несколько потоков (Ctrl/Command + клик)</div>
          </div>
          <div class="mb-3">
            <label for="mailingText" class="form-label">Текст сообщения</label>
            <textarea class="form-control" id="mailingText" name="message" rows="4" required></textarea>
          </div>
          <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-danger">Разослать</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <!-- Автоматизация -->
  <div class="tab-pane fade" id="automation" role="tabpanel" aria-labelledby="automation-tab">
    <div class="row g-4">
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3" style="background: linear-gradient(90deg, #ff9966 0%, #ff5e62 100%);">
  <div class="relove-card-title">Массовый анализ профилей</div>
          <div class="card-body">
            <p class="card-text">Запустить массовый сбор и анализ профилей пользователей открытого канала.</p>
            <form method="post" action="/dashboard/auto_analyze">
              <button type="submit" class="btn btn-primary">Запустить анализ профилей</button>
            </form>
            <div class="mt-2">
              <span class="badge bg-secondary">Статус: Не запущено</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3" style="background: linear-gradient(90deg, #ff9966 0%, #ff5e62 100%);">
  <div class="relove-card-title">Массовое определение пола</div>
          <div class="card-body">
            <p class="card-text">Автоматически определить пол у всех пользователей по профилю.</p>
            <form method="post" action="/dashboard/auto_gender">
              <button type="submit" class="btn btn-info">Запустить определение пола</button>
            </form>
            <div class="mt-2">
              <span class="badge bg-secondary">Статус: Не запущено</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3" style="background: linear-gradient(90deg, #ff9966 0%, #ff5e62 100%);">
  <div class="relove-card-title">Массовое психологическое профилирование</div>
          <div class="card-body">
            <p class="card-text">Собрать психологические портреты всех пользователей.</p>
            <form method="post" action="/dashboard/auto_psych">
              <button type="submit" class="btn btn-warning">Запустить профилирование</button>
            </form>
            <div class="mt-2">
              <span class="badge bg-secondary">Статус: Не запущено</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3" style="background: linear-gradient(90deg, #ff9966 0%, #ff5e62 100%);">
  <div class="relove-card-title">Автоматическая рассылка приветствий</div>
          <div class="card-body">
            <p class="card-text">Включить/отключить автоматическую рассылку приветственных сообщений новым участникам.</p>
            <form method="post" action="/dashboard/auto_welcome">
              <button type="submit" class="btn btn-success">Запустить рассылку приветствий</button>
            </form>
            <div class="mt-2">
              <span class="badge bg-secondary">Статус: Не запущено</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3" style="background: linear-gradient(90deg, #ff9966 0%, #ff5e62 100%);">
  <div class="relove-card-title">Шаблон приветственного сообщения</div>
          <div class="card-body">
            <form method="post" action="/dashboard/welcome_template">
              <div class="mb-3">
                <label for="welcomeTemplate" class="form-label">Текст приветствия</label>
                <textarea class="form-control" id="welcomeTemplate" name="welcome_template" rows="3"></textarea>
              </div>
              <button type="submit" class="btn btn-secondary">Сохранить шаблон</button>
            </form>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3" style="background: linear-gradient(90deg, #ff9966 0%, #ff5e62 100%);">
  <div class="relove-card-title">Массовая рассылка о событиях</div>
          <div class="card-body">
            <form method="post" action="/dashboard/broadcast_events">
              <div class="mb-3">
                <label for="eventText" class="form-label">Текст события</label>
                <textarea class="form-control" id="eventText" name="event_text" rows="2" required></textarea>
              </div>
              <button type="submit" class="btn btn-danger">Разослать всем</button>
            </form>
            <div class="mt-2">
              <span class="badge bg-secondary">Статус: Не запущено</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3" style="background: linear-gradient(90deg, #ff9966 0%, #ff5e62 100%);">
  <div class="relove-card-title">Массовое создание напоминаний</div>
          <div class="card-body">
            <form method="post" action="/dashboard/auto_reminders">
              <div class="mb-3">
                <label for="reminderText" class="form-label">Текст напоминания</label>
                <textarea class="form-control" id="reminderText" name="reminder_text" rows="2" required></textarea>
              </div>
              <div class="mb-3">
                <label for="reminderTimestamp" class="form-label">Время отправки (UNIX timestamp)</label>
                <input type="number" class="form-control" id="reminderTimestamp" name="reminder_time" required>
              </div>
              <button type="submit" class="btn btn-dark">Создать напоминания</button>
            </form>
            <div class="mt-2">
              <span class="badge bg-secondary">Статус: Не запущено</span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-6">
        <div class="relove-card mb-3" style="background: linear-gradient(90deg, #ff9966 0%, #ff5e62 100%);">
  <div class="relove-card-title">Интеграция с каналами</div>
  <div class="card-body">
    <p>Текущие каналы и чаты для интеграции:</p>
    <ul class="list-group mb-2">
      
    </ul>
    <span class="badge bg-secondary">Статус: OK</span>
  </div>
</div>
      </div>
    </div>
  </div>

      <!-- Аналитика -->
      <!-- ... (существующий код аналитики) ... -->
      <!-- Автоматизация -->
      <div class="tab-pane fade" id="automation" role="tabpanel" aria-labelledby="automation-tab">
        <div class="row g-4">
          <div class="col-12 col-lg-6">
            <div class="card border-primary mb-3">
              <div class="card-header bg-primary text-white">Массовый анализ профилей</div>
              <div class="card-body">
                <p class="card-text">Запустить массовый сбор и анализ профилей пользователей открытого канала.</p>
                <form method="post" action="/dashboard/auto_analyze">
                  <button type="submit" class="btn btn-primary">Запустить анализ профилей</button>
                </form>
                <div class="mt-2">
                  <span class="badge bg-secondary">Статус: Не запущено</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-info mb-3">
              <div class="card-header bg-info text-dark">Массовое определение пола</div>
              <div class="card-body">
                <p class="card-text">Автоматически определить пол у всех пользователей по профилю.</p>
                <form method="post" action="/dashboard/auto_gender">
                  <button type="submit" class="btn btn-info">Запустить определение пола</button>
                </form>
                <div class="mt-2">
                  <span class="badge bg-secondary">Статус: Не запущено</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-warning mb-3">
              <div class="card-header bg-warning text-dark">Массовое психологическое профилирование</div>
              <div class="card-body">
                <p class="card-text">Собрать психологические портреты всех пользователей.</p>
                <form method="post" action="/dashboard/auto_psych">
                  <button type="submit" class="btn btn-warning">Запустить профилирование</button>
                </form>
                <div class="mt-2">
                  <span class="badge bg-secondary">Статус: Не запущено</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-success mb-3">
              <div class="card-header bg-success text-white">Автоматическая рассылка приветствий</div>
              <div class="card-body">
                <p class="card-text">Включить/отключить автоматическую рассылку приветственных сообщений новым участникам.</p>
                <form method="post" action="/dashboard/auto_welcome">
                  <button type="submit" class="btn btn-success">Запустить рассылку приветствий</button>
                </form>
                <div class="mt-2">
                  <span class="badge bg-secondary">Статус: Не запущено</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-secondary mb-3">
              <div class="card-header bg-secondary text-white">Шаблон приветственного сообщения</div>
              <div class="card-body">
                <form method="post" action="/dashboard/welcome_template">
                  <div class="mb-3">
                    <label for="welcomeTemplate" class="form-label">Текст приветствия</label>
                    <textarea class="form-control" id="welcomeTemplate" name="welcome_template" rows="3"></textarea>
                  </div>
                  <button type="submit" class="btn btn-secondary">Сохранить шаблон</button>
                </form>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-danger mb-3">
              <div class="card-header bg-danger text-white">Массовая рассылка о событиях</div>
              <div class="card-body">
                <form method="post" action="/dashboard/broadcast_events">
                  <div class="mb-3">
                    <label for="eventText" class="form-label">Текст события</label>
                    <textarea class="form-control" id="eventText" name="event_text" rows="2" required></textarea>
                  </div>
                  <button type="submit" class="btn btn-danger">Разослать всем</button>
                </form>
                <div class="mt-2">
                  <span class="badge bg-secondary">Статус: Не запущено</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-dark mb-3">
              <div class="card-header bg-dark text-white">Массовое создание напоминаний</div>
              <div class="card-body">
                <form method="post" action="/dashboard/auto_reminders">
                  <div class="mb-3">
                    <label for="reminderText" class="form-label">Текст напоминания</label>
                    <textarea class="form-control" id="reminderText" name="reminder_text" rows="2" required></textarea>
                  </div>
                  <div class="mb-3">
                    <label for="reminderTimestamp" class="form-label">Время отправки (UNIX timestamp)</label>
                    <input type="number" class="form-control" id="reminderTimestamp" name="reminder_time" required>
                  </div>
                  <button type="submit" class="btn btn-dark">Создать напоминания</button>
                </form>
                <div class="mt-2">
                  <span class="badge bg-secondary">Статус: Не запущено</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-6">
            <div class="card border-info mb-3">
              <div class="card-header bg-info text-dark">Интеграция с каналами</div>
              <div class="card-body">
                <p>Текущие каналы и чаты для интеграции:</p>
                <ul class="list-group mb-2">
                  
                </ul>
                <span class="badge bg-secondary">Статус: OK</span>
              </div>
        </div>
      </div>

    

      <!-- Аналитика -->
      <div class="tab-pane fade show active" id="analytics" role="tabpanel" aria-labelledby="analytics-tab">
        <div class="row mb-4 justify-content-center g-3 flex-nowrap overflow-auto" style="gap: 1.5rem;">
            <div class="col-auto" style="min-width:200px;">
                <div class="card relove-card relove-metric text-center">
                    <div class="card-body">
                        <div class="relove-metric-icon">❤️</div>
                        <div class="relove-metric-value">467</div>
                        <div class="relove-metric-label">Пользователей</div>
                    </div>
                </div>
            </div>
            <div class="col-auto" style="min-width:200px;">
                <div class="card relove-card relove-metric text-center">
                    <div class="card-body">
                        <div class="relove-metric-icon">♂️</div>
                        <div class="relove-metric-value">290</div>
                        <div class="relove-metric-label">Мужчин</div>
                    </div>
                </div>
            </div>
            <div class="col-auto" style="min-width:200px;">
                <div class="card relove-card relove-metric text-center">
                    <div class="card-body">
                        <div class="relove-metric-icon">♀️</div>
                        <div class="relove-metric-value">177</div>
                        <div class="relove-metric-label">Женщин</div>
                    </div>
                </div>
            </div>
            <div class="col-auto" style="min-width:200px;">
                <div class="card relove-card relove-metric text-center">
                    <div class="card-body">
                        <div class="relove-metric-icon">❓</div>
                        <div class="relove-metric-value">0</div>
                        <div class="relove-metric-label">Не указано</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row g-4">
            <div class="col-12 col-lg-6">
                <div class="card chart-card">
                    <div class="card-body">
                        <h5 class="card-title">Распределение по полу</h5>
                        <canvas id="gender-chart" style="max-height:340px;"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-12 col-lg-6">
                <div class="card chart-card">
                    <div class="card-body">
                        <h5 class="card-title">Распределение по потокам</h5>
                        <canvas id="streams-chart" style="max-height:340px;"></canvas>
                    </div>
                </div>
            </div>
        </div>
      </div>
      <!-- Пользователи -->
      <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="users-tab">
        <form class="relove-form search-form mb-4" method="get" action="/admin/search">
          <div class="input-group">
            <input type="text" class="form-control" name="query" placeholder="ID, имя, username, поток..." style="border-radius: 1rem 0 0 1rem;">
            <button class="relove-btn" type="submit">Искать</button>
          </div>
        </form>
        <div class="modern-users-grid"></div>
<style>
.user-list-grid-modern {
  width: 100%;
  margin: 0 auto;
  display: grid;
  grid-template-columns: 1fr;
  gap: 22px;
  padding: 0 0 24px 0;
  max-width: 1200px;
}
@media (min-width: 700px) {
  .user-list-grid-modern {
    grid-template-columns: 1fr 1fr;
    gap: 28px;
  }
}
@media (min-width: 1100px) {
  .user-list-grid-modern {
    grid-template-columns: 1fr 1fr 1fr;
    gap: 32px;
  }
}

@media (min-width: 600px) {
  .user-list-grid {
    grid-template-columns: 1fr 1fr;
    gap: 18px;
  }
}
@media (min-width: 1000px) {
  .user-list-grid {
    grid-template-columns: 1fr 1fr 1fr;
    gap: 18px;
  }
}
.user-card-bg-modern {
  position: relative;
  min-height: 180px;
  min-width: 0;
  border-radius: 1.2em;
  box-shadow: 0 2px 18px 0 rgba(127,83,172,0.11);
  display: flex;
  align-items: flex-end;
  justify-content: center;
  overflow: hidden;
  background-size: cover;
  background-position: center;
  transition: box-shadow .13s;
}
.user-card-bg-modern:hover {
  box-shadow: 0 8px 28px 0 rgba(127,83,172,0.18);
}
.user-card-bg-overlay-modern {
  position: absolute;
  inset: 0;
  background: linear-gradient(0deg, rgba(40,18,60,0.32) 70%, rgba(40,18,60,0.07) 100%);
  z-index: 1;
}
.user-summary-bg-modern {
  position: relative;
  z-index: 2;
  color: #fff;
  background: rgba(127,83,172,0.82);
  border-radius: 0.9em 0.9em 0 0;
  padding: 0.9em 1.2em 0.9em 1.2em;
  font-size: 1.08em;
  font-weight: 500;
  text-align: center;
  max-width: 95%;
  min-width: 0;
  word-break: break-word;
  box-shadow: 0 2px 12px 0 rgba(127,83,172,0.10);
  display: -webkit-box;
  -webkit-line-clamp: 4;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  line-clamp: 4;
  min-height: 2.8em;
  margin: 0.7em 0.6em 1.1em 0.6em;
  opacity: 0.98;
}
@media (max-width: 900px) {
  .user-summary-bg-modern {
    font-size: 0.98em;
    padding: 0.7em 0.6em 0.7em 0.6em;
  }
  .user-card-bg-modern {
    min-height: 120px;
  }
}
@media (max-width: 600px) {
  .user-card-bg-modern {
    min-height: 90px;
  }
  .user-summary-bg-modern {
    font-size: 0.93em;
    padding: 0.5em 0.3em 0.5em 0.3em;
    border-radius: 0.7em;
  }
}

.user-card-vertical:hover {
  box-shadow: 0 4px 24px 0 rgba(127,83,172,0.17);
}
.user-photo-vertical {
  width: 58px;
  height: 58px;
  border-radius: 50%;
  overflow: hidden;
  background: linear-gradient(135deg, #e0e6fa 70%, #f8e1f6 100%);
  margin-bottom: 7px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.user-photo-vertical img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}
.user-photo-empty-vertical {
  width: 100%;
  height: 100%;
  background: repeating-linear-gradient(135deg, #e0e6fa 0 10px, #f8e1f6 10px 20px);
  border-radius: 50%;
}
.user-summary-vertical {
  margin-top: 0;
  color: #7f53ac;
  background: #f5f2fa;
  border-radius: 0.6em;
  padding: 0.45em 0.7em 0.45em 0.7em;
  font-size: 0.93em;
  font-weight: 400;
  text-align: center;
  max-width: 96%;
  min-width: 0;
  word-break: break-word;
  box-shadow: 0 1px 4px 0 rgba(127,83,172,0.05);
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  line-clamp: 3;
  height: auto;
  min-height: 2.7em;
}
@media (max-width: 600px) {
  .user-list-grid {
    max-width: 100%;
    padding: 0 2vw 18px 2vw;
  }
  .user-card-vertical {
    padding: 8px 2vw 8px 2vw;
  }
  .user-photo-vertical {
    width: 44px;
    height: 44px;
  }
  .user-summary-vertical {
    font-size: 0.87em;
    padding: 0.33em 0.5em 0.33em 0.5em;
  }
}
</style>
      </div>
      <!-- Рассылка -->
      <div class="tab-pane fade" id="mailing" role="tabpanel" aria-labelledby="mailing-tab">
        <div class="row justify-content-center">
          <div class="col-md-7 col-lg-6">
            <form method="post" action="/admin/mailing" class="relove-form">
              <h5 class="mb-3">Создать рассылку</h5>
              <div class="mb-3">
                <label for="genderSelect" class="form-label">Пол</label>
                <select class="form-select" id="genderSelect" name="gender">
                  <option value="">Любой</option>
                  <option value="male">Мужской</option>
                  <option value="female">Женский</option>
                  <option value="unknown">Не указан</option>
                </select>
              </div>
              <div class="mb-3">
                <label for="streamsSelect" class="form-label">Потоки</label>
                <select multiple class="form-select" id="streamsSelect" name="streams">
                  
                  <option value="Женский">Женский</option>
                  
                  <option value="Мужской">Мужской</option>
                  
                  <option value="Смешанный">Смешанный</option>
                  
                  <option value="Путь героя">Путь героя</option>
                  
                </select>
                <div class="form-text">Можно выбрать несколько потоков (Ctrl/Command + клик)</div>
              </div>
              <div class="mb-3">
                <label for="mailingText" class="form-label">Текст сообщения</label>
                <textarea class="form-control" id="mailingText" name="message" rows="4" required></textarea>
              </div>
              <div class="d-flex justify-content-end">
                <button type="submit" class="btn btn-danger">Разослать</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
</div>
<script>
let genderChart, streamsChart;

function renderGenderChart(male, female, unknown) {
    const ctx = document.getElementById('gender-chart').getContext('2d');
    if (genderChart) genderChart.destroy();
    genderChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Мужчины', 'Женщины', 'Не указано'],
            datasets: [{
                data: [male, female, unknown],
                backgroundColor: [
                    '#e94e77', // розовый reLove
                    '#b721ff', // фиолетовый reLove
                    '#36d1c4'  // мятный reLove
                ],
                borderColor: [
                    '#fff0f8',
                    '#f3e6ff',
                    '#e0fffa'
                ],
                borderWidth: 3,
                hoverOffset: 16,
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom', labels: { color: '#b721ff', font: { size: 16, weight: 'bold' } } },
                tooltip: {
                    backgroundColor: '#fff0f8',
                    titleColor: '#e94e77',
                    bodyColor: '#1a1a1a',
                    borderColor: '#b721ff',
                    borderWidth: 2
                }
            }
        }
    });
}
function renderStreamsChart(labels, counts) {
    const ctx = document.getElementById('streams-chart').getContext('2d');
    if (streamsChart) streamsChart.destroy();
    streamsChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Пользователей',
                data: counts,
                backgroundColor: [
                    '#e94e77', // розовый
                    '#b721ff', // фиолетовый
                    '#36d1c4', // мятный
                    '#ffd6ec', // светло-розовый
                    '#7f53ac', // тёмно-фиолетовый
                    '#ffaf7b'  // персиковый
                ],
                borderRadius: 8,
                borderSkipped: false,
                borderColor: '#fff0f8',
                borderWidth: 2,
                hoverBackgroundColor: '#b721ff',
                hoverBorderColor: '#e94e77',
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: '#fff0f8',
                    titleColor: '#e94e77',
                    bodyColor: '#1a1a1a',
                    borderColor: '#b721ff',
                    borderWidth: 2
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: '#ffd6ec' },
                    ticks: { color: '#b721ff', font: { size: 15 } }
                },
                x: {
                    grid: { color: '#f3e6ff' },
                    ticks: { color: '#e94e77', font: { size: 15 } }
                }
            }
        }
    });
}

async function fetchDashboardData() {
    console.log('fetchDashboardData: отправка запроса на /api/dashboard_data');
    try {
        const resp = await fetch('/api/dashboard_data?_=' + Date.now());
        if (!resp.ok) return;
        const data = await resp.json();
        // Обновление графиков
        renderGenderChart(data.male_count, data.female_count, data.unknown_count);
        renderStreamsChart(data.stream_labels, data.stream_counts);
        // Обновление пользователей
        const usersGrid = document.querySelector('.modern-users-grid');
        if (usersGrid && Array.isArray(data.users)) {
            usersGrid.innerHTML = data.users.map(user => `
  <div class="modern-user-card">
    <div class="modern-user-photo-wrap">
      ${user.photo_jpeg ? `<img class='modern-user-photo' src="data:image/jpeg;base64,${user.photo_jpeg}" alt="Фото">` : `<span class='modern-user-photo--empty'>👤</span>`}
      <div class="modern-user-summary">${user.profile_summary ? user.profile_summary : '—'}</div>
    </div>
  </div>
`).join('');
        }
    } catch (e) { /* ignore */ }
}
document.addEventListener('DOMContentLoaded', function() {
    // Первичная загрузка данных пользователей и графиков
    fetchDashboardData();
    // Периодическое обновление
    setInterval(fetchDashboardData, 15000);
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>